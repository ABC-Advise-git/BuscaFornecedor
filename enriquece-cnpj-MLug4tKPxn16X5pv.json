{"updatedAt":"2025-12-02T16:39:03.636Z","createdAt":"2025-10-02T13:46:39.454Z","id":"MLug4tKPxn16X5pv","name":"Enriquece-CNPJ","active":true,"isArchived":false,"nodes":[{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-2768,-816],"id":"49128f28-0b2a-4d67-8871-d9a5708ad0e3","name":"Structured Output Parser"},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1024,-992],"id":"320c4946-17a8-42c6-830d-22db96b8babf","name":"Structured Output Parser3"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2400,-976],"id":"250c1a14-fbc7-4a0f-bee2-cddb3f66cd67","name":"Structured Output Parser5"},{"parameters":{"assignments":{"assignments":[{"id":"2eb1014d-2a4f-4fb0-8882-2dd3fb33ac1a","name":"data","value":"={{ $json.organic }}","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3568,-1152],"id":"285f5a4f-2ba0-4005-9b3b-73262f47d0dc","name":"busca_google"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $('busca_google').item.json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**Rejeite:**\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n\n## Formato de Resposta\n\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\"\n}\n```"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-2928,-1024],"id":"70a83992-38db-46cb-a5fe-e4fdb4f14938","name":"find_company_website","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[448,-1184],"id":"37d7389e-0d7a-4815-ae11-1afe1c450d70","name":"merge_clienteNmain"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $json.texto_page_home }}\n\nTexto Page Cliente: {{ $json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[832,-1168],"id":"f75a6fd6-bc30-474a-a66e-02579ca0e79b","name":"resumo_atuacao","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[2256,-1168],"id":"28f85ac1-177d-4954-8f04-f2ad8ffc183b","name":"busca_clientes","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-592,-752],"id":"a789761f-2e27-40bb-a202-3514a747d6de","name":"find_client_page","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"0fdc91d3-9fcc-4761-a907-6d80b362a03c","name":"texto_page_cliente","value":"={{ $json.fullCleanedStringCliente }}","type":"string"},{"id":"37a2eff7-d35e-48be-ad84-28f68a21851b","name":"texto_page_potifolio","value":"={{ $json.fullCleanedStringPortifolio }}","type":"string"},{"id":"69c34852-62c4-4f4d-82a7-bc5d4dae0149","name":"texto_page_home","value":"={{ $json.fullCleanedStringHome }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[576,-1168],"id":"7f62eef3-affd-4f7e-8a4c-31376b10218e","name":"textos_site"},{"parameters":{"content":"## Chama uma API externa:\n- Passa a razão social como parâmetro\n- Encontra possíveis sites para a empresa","height":304,"width":432,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3824,-1296],"id":"248a2455-9637-407b-a2a4-d39ce13116bf","name":"Sticky Note22"},{"parameters":{"url":"={{ $json.output.link_clientes }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-1376],"id":"4f88d481-f864-4d14-be1b-9157a65fadd9","name":"get_cliente","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.output.link_portfolio }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-1168],"id":"95f168ff-7723-461a-9537-14176b81c1a8","name":"get_portifolio","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.output.link_home}}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-960],"id":"fa7e66fc-1bc3-4020-93b9-f209ab81db9a","name":"get_home","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"path":"3cb44ad0-3cd0-4ffa-8193-1d009acc8628","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-3936,-1152],"id":"360e24b4-b203-4258-832b-5c748a708e9c","name":"Webhook","webhookId":"3cb44ad0-3cd0-4ffa-8193-1d009acc8628"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"2b57e8bc097d1367753763457b13c8d774fd68e9"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"q","value":"={{ $json.body.data.razao_social }}"},{"name":"gl","value":"br"},{"name":"hl","value":"pt-br"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3760,-1152],"id":"37f423bb-a797-4a0b-a38b-589673ed6615","name":"Serper_search","retryOnFail":true},{"parameters":{"content":"## IA: Define qual o site oficial da empresa.\n\n- Recebe os sites encontrados na busca.\n- Recebe informações cadastrais da empresa buscada.\n- Define qual dentre os sites recebidos é o site oficial da empresa.\n- Caso não encontre o site o banco é atualizado.\n\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```","height":976,"width":1248,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3376,-1520],"id":"36397d93-cce6-400c-97f2-42720a7ab553","name":"Sticky Note24"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.output.site }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"equals"},"id":"41e6c94e-ffa6-4367-a21d-007867c2b030"}],"combinator":"and"},"renameOutput":true,"outputKey":"site_nao_encontrado"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1f1b15d1-c2eb-4b5f-a921-63bae2dfa299","leftValue":"={{ $json.output.site }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"site_encontrado"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2112,-1136],"id":"28cf35b0-0e74-4f36-997e-a9d0b181e40f","name":"encontrou_site?"},{"parameters":{"useCustomSchema":true,"schema":"cnpj_db","operation":"update","tableId":"estabelecimento","matchType":"allFilters","filters":{"conditions":[{"keyName":"cnpj_basico","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_basico }}"},{"keyName":"cnpj_dv","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_dv }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"site","fieldValue":"={{ $json.output.site }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1840,-1264],"id":"e3264e5e-2e24-48b9-a05d-54f16afbaf57","name":"site_nãoEncontrado","credentials":{"supabaseApi":{"id":"iSQjasVk6wzJgBch","name":"Supabase account"}}},{"parameters":{"url":"={{ $json.output.site }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1856,-976],"id":"1f2ec90f-1065-4dc8-a8d7-075301bbd855","name":"acessa_site_oficial","retryOnFail":true,"maxTries":3,"alwaysOutputData":true,"waitBetweenTries":1500,"onError":"continueRegularOutput"},{"parameters":{"operation":"extractHtmlContent","extractionValues":{"values":[{"key":"links","cssSelector":"a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-1664,-976],"id":"90cca218-09a7-4c03-84e8-5515df3dae45","name":"extrai_info_site","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"content":"## Chama uma API externa:\n- Acessa o HTML do site da empresa.\n- Extrai Links da página","height":304,"width":416,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1920,-1104],"id":"5b09937f-4824-444f-88cf-2936943deb6d","name":"Sticky Note23"},{"parameters":{"content":"## Banco de dados:\n- Atualiza o site da empresa para \"nao_encontrado\"","height":240,"width":256,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1920,-1360],"id":"9a2001ce-6d13-46c3-8177-1630b4261a9d","name":"Sticky Note21"},{"parameters":{"content":"## IA: Busca Páginas.\n- Realiza uma busca entre os links.\n\n- Encontra paginas de:\n-- cliente\n-- portifolio\n-- home\n\n```json\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\n```","height":1440,"width":1376,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1488,-1552],"id":"a4a090bc-aadd-48b5-a5c2-e71ce4e1407f","name":"Sticky Note25"},{"parameters":{"content":"## Chama uma API externa:\n- Acessa paginas de portifolio, cliente e home.\n- Extrai informações dos htmls dessas páginas","height":752,"width":784,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-96,-1552],"id":"672e854d-e6e3-4492-b5ae-1aac5164720e","name":"Sticky Note26"},{"parameters":{"content":"## IA: Resume Atuação.\n- Acessa os dados de home e página de clientes.\n- baseado nessas informações define um resumo da atuação da empresa.\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```","height":960,"width":1488,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[704,-1520],"id":"8ea6a6f6-9f89-40bb-8470-ad1f6485273b","name":"Sticky Note"},{"parameters":{"content":"## IA: Busca Clientes\n- Acessa os dados de home e página de clientes.\n- baseado nessas informações procura possíveis cientes relevantes da empresa.\n\n```json\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n```","height":848,"width":1632,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2208,-1408],"id":"06dfb578-5475-4f29-be40-b96ba182ca4e","name":"Sticky Note1"},{"parameters":{"content":"## IA: Identifica Industria\n- Acessa os dados da página de clientes.\n- baseado nessas informações define o segmento industrial da empresa.\n\n```json\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n```","height":1056,"width":1456,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3856,-1616],"id":"c619d71c-1d02-48a6-9b45-926f8ddec698","name":"Sticky Note2"},{"parameters":{"content":"## Banco de dados:\n- Atualiza o banco da empresa com as informações coletadas.","height":272,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[5552,-1296],"id":"dcb980c8-bca1-4236-ac82-db732f30f042","name":"Sticky Note27"},{"parameters":{"useCustomSchema":true,"schema":"cnpj_db","operation":"update","tableId":"estabelecimento","matchType":"allFilters","filters":{"conditions":[{"keyName":"cnpj_basico","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_basico }}"},{"keyName":"cnpj_dv","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_dv }}"},{"keyName":"cnpj_ordem","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_ordem }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"clientes","fieldValue":"={{ $json.clientes.clientes  || \"nao_encontrado\"}}"},{"fieldId":"site","fieldValue":"={{ $('encontrou_site?').item.json.output.site  || \"nao_encontrado\"}}"},{"fieldId":"resumo_empresa","fieldValue":"={{ $json.actuacao.resumo_empresa || \"nao_encontrado\"}}"},{"fieldId":"segmentos_industriais","fieldValue":"={{ $json.industrias.industrias || \"nao_encontrado\" }}"},{"fieldId":"tipo_fornecedor","fieldValue":"={{ $json.actuacao.tipo_fornecedor || \"nao_encontrado\" }}"},{"fieldId":"especialidades","fieldValue":"={{ $json.actuacao.especialidades || \"nao_encontrado\" }}"},{"fieldId":"exemplo_servico","fieldValue":"={{ $json.actuacao.exemplos_servico || \"nao_encontrado\" }}"},{"fieldId":"categorias_materais","fieldValue":"={{ $json.actuacao.categorias_materiais || \"nao_encontrado\" }}"},{"fieldId":"=telefone","fieldValue":"={{ $json.actuacao.telefone || \"nao_encontrado\" }}"},{"fieldId":"instagram","fieldValue":"={{ $json.actuacao.instagram || \"nao_encontrado\" }}"},{"fieldId":"email","fieldValue":"={{ $json.actuacao.email || \"nao_encontrado\" }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[5856,-1168],"id":"4c50ba98-9ef1-45d4-949d-2e809676c637","name":"update_empresa","credentials":{"supabaseApi":{"id":"iSQjasVk6wzJgBch","name":"Supabase account"}}},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringCliente = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringCliente\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-1376],"id":"262f91b6-3c97-46a2-9e80-f57fe22a895c","name":"limpa_cliente"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringPortifolio = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringPortifolio\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-1168],"id":"1c877166-1040-481d-91c1-3bdd2dc06660","name":"limpa_portifolio"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringHome = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringHome\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-960],"id":"9f67e1f1-e458-4cf5-bbd4-dfa2dac7155b","name":"limpa_home"},{"parameters":{"content":"## Limpa o HTML extraído.","height":624,"width":304,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[112,-1440],"id":"7b70b77b-216c-401a-a388-53d334075bf7","name":"Sticky Note36"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-2928,-816],"id":"41fda38a-6eb4-41f8-94ac-9546fbdceede","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-624,-256],"id":"c1df6c72-1df9-4a17-ada1-024d90f648a8","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\",\n    \"site_oficial\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3168,-960],"id":"06e1ac25-40bb-4447-a2e7-f0da4b57ec48","name":"Structured Output Parser1"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador, SerasaExperian)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**NÃO ACEITE DE MANEIRA ALGUMA:**\nRESULTADOS QUE EXIBEM UM DOMINIO ENQUADRADO DENTRO DOS TIPOS ABAIXO SÃO CONSIDERADOS COMO \"NÃO CONFIAVEIS\" E NÃO DEVEM SER RETORNADOS, AO INVÈS DISSO RESPONDA COM \"nao_encontrado\".\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n- `https://econodata.com.br/empresa-xyz` → diretório empresarial sem vínculo institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n- `https://facebook.com/empresa-xyz` → perfil em redes sociais, não institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n\n\n\n## Formato de Resposta\n\nO parametro \"site_oficial\" deve ser \"sim \"\n para sites que com certeza pertencem a empresa em si, não representando sites de terceiros ou menções ou diretórios ou qualquer coisa nesse sentido. Sites que não estão em contro da empresa e são diretórios ou sites de terceitos, devem ter \"site_oficial\" = \"nao\".\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos, não se trata de nenhum diretório ou site de terceiros, é sem sombra de dúvidas o site oficial de controle da empresa..\",\n \"site_oficial\" : \"sim\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\",\n \"site_oficial\" : \"nao\"\n}\n```\n\n\nApenas diretórios, redes sociais, ou marketplaces foram encontrados:\n```json\n{\n\"site\": \"nao_encontrado\",\n\"justificativa\": \"Os domínios https://cnpj.biz/40754585000150\" e \"https://www.econodata.com.br/consulta-empresa/40754585000150-lf-industria-e-comercio-de-esteiras-e-peneiras-metalicas-ltda\" o dominio  representa um diretório empresarial que contém o CNPJ da empresa, não é uma fonte oficial controlada pela empresa logo não é confiável e não deve ser retornado.,\n \"site_oficial\" : \"nao\"\n}\n```\n\nSites confiáveis mas não oficiais de pertencimento da empresa.\n\n```json\n{\n\"site\": \"nao_encontrado\",\n\"justificativa\": \"O site da Serasa Experian \"https://empresas.serasaexperian.com.br/consulta-gratis/LF-INDUSTRIA-E-COMERCIO-DE-ESTEIRAS-E-PENEIRAS-METALICAS-LTDA-40754585000150\", possui informações detalhadas, incluindo endereço em Gravataí, atividade econômica compatível, e o CNPJ correspondente, mas não é um site opficial da empresa.,\n \"site_oficial\" : \"nao\"\n}\n```\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-3328,-1152],"id":"49fdd1d1-3cbe-41b0-a6a3-16e11141f9a6","name":"find_company_website1","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-2384,-688],"id":"2e8fbdd7-5e09-4884-8f9b-04aa2af3beb6","name":"Structured Output Parser2"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $('busca_google').item.json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**Rejeite:**\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n\n## Formato de Resposta\n\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\"\n}\n```"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-2544,-896],"id":"38d8657e-36ff-4af8-8cde-ece4e3a2f1cc","name":"find_company_website2","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-3328,-960],"id":"5e0eaca3-0663-45b4-9ee4-0d4f933cef3b","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"model":"grok-4-1-fast-non-reasoning","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[-2544,-688],"id":"612559ff-6a6c-4707-994a-261cdc113cd6","name":"xAI Grok Chat Model","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-1328,-768],"id":"bb295071-3475-4b21-bd32-13100046a863","name":"Structured Output Parser7"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\n\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-1456,-976],"id":"43217b12-53d7-4686-9280-0d00a8599e8b","name":"find_client_page1","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-944,-640],"id":"c9d19a0b-9493-46e6-adca-a00b7efcecc7","name":"Structured Output Parser8"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-1024,-832],"id":"9cf4d8d1-ff4a-4cea-bcaa-727588183abc","name":"find_client_page2","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-1456,-544],"id":"a264a58a-9bd3-4056-b87e-1627ce494dce","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"model":"grok-4-fast-reasoning","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[-1088,-464],"id":"50e9a086-f120-4a89-b55b-9c0fb074dff9","name":"xAI Grok Chat Model1","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-464,-544],"id":"188c1fc7-5b6a-4f84-ada3-6600f55e14c3","name":"Structured Output Parser4"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[752,-960],"id":"28032c10-6da4-41bc-8975-9693149e142f","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1376,-800],"id":"48aabc16-ebb0-4240-8053-f8a03642d368","name":"Structured Output Parser9"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1232,-1024],"id":"7c188261-8278-4370-88a4-83988af3b85c","name":"resumo_atuacao1","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1776,-736],"id":"4b826f48-e939-4bfc-9a56-d3900dee1e8d","name":"Structured Output Parser10"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1632,-944],"id":"7e65b85e-f530-4199-810d-27031879dd86","name":"resumo_atuacao2","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2944,-784],"id":"df065f47-710b-411d-be8c-48cf7bd47886","name":"Structured Output Parser11"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[2752,-1040],"id":"7fdff420-793a-4b19-9f76-a8a99c0b2a02","name":"busca_clientes1","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3488,-752],"id":"01844728-4261-4317-8e0b-2247d09ba114","name":"Structured Output Parser12"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[3280,-928],"id":"65a2de16-59f2-43ee-9b75-03230d74a1b0","name":"busca_clientes2","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[3264,-736],"id":"7b8873c6-9512-41bf-84c6-f4de72d247b7","name":"Google Gemini Chat Model6","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1600,-736],"id":"2603e0ad-d98d-4b78-a543-f78da23c67f7","name":"Google Gemini Chat Model5","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[2720,-816],"id":"0ee26ceb-6cd1-4b8f-ac2e-15e96b82d976","name":"xAI Grok Chat Model2","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[1232,-800],"id":"0d71c92c-3ca8-4ce2-85b7-9652bbd870e7","name":"xAI Grok Chat Model3","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[2240,-960],"id":"839429d9-8917-4e45-b12d-1683006cf4c2","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[4544,-816],"id":"ac036a8a-a5d0-492b-af85-35fa52a9a1a8","name":"Structured Output Parser13"},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $('set_clients').item.json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[4368,-1056],"id":"2f242892-ad82-4357-a6db-cba08e74b0dd","name":"identifica_industria1","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[5024,-752],"id":"cbdf5f91-3d18-4af3-8f98-cdbac4c79e4e","name":"Structured Output Parser14"},{"parameters":{"promptType":"define","text":"=Clientes: {{ $('set_clients').item.json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[4816,-928],"id":"f7336017-d718-448d-88a7-8211ab429c84","name":"identifica_industria2","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[4352,-816],"id":"339a182e-883d-4cbc-ab6e-42bd87a83a4e","name":"xAI Grok Chat Model4","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[4784,-720],"id":"c5971adf-4b52-4a1e-8052-c6c8f0e28f5d","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"7f68dea5-0451-4f58-bddf-330841d32c45","name":"output.clientes","value":"={{ $json.output.clientes }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3728,-1168],"id":"433e5595-565f-460e-9b26-416eec2b73c8","name":"set_clients"},{"parameters":{"assignments":{"assignments":[{"id":"ae01ea4e-3b10-4c32-b69f-16f824c9e221","name":"output.resumo_empresa","value":"={{ $json.output.resumo_empresa }}","type":"string"},{"id":"b2a6e0d2-37d9-47f9-93bf-b2f0e63d52a8","name":"output.tipo_fornecedor","value":"={{ $json.output.tipo_fornecedor }}","type":"string"},{"id":"94c372d3-8989-4039-9ab4-34f3ec0926e9","name":"output.especialidades","value":"={{ $json.output.especialidades }}","type":"string"},{"id":"1507e688-1b94-48b4-98fb-76e46a8d6f41","name":"output.exemplos_servico","value":"={{ $json.output.exemplos_servico }}","type":"string"},{"id":"d75c69c3-dbe4-47cc-a8b8-0f0787a32bae","name":"output.categorias_materiais","value":"={{ $json.output.categorias_materiais }}","type":"string"},{"id":"9ef619cb-9d11-49dc-bb40-b355fa2f9368","name":"output.telefone","value":"={{ $json.output.telefone }}","type":"string"},{"id":"d655ae9a-70b4-4ecb-bb4e-fb440b97f6e1","name":"output.instagram","value":"={{ $json.output.instagram }}","type":"string"},{"id":"c3794956-d929-48e0-9500-d0ace027d8cf","name":"output.email","value":"={{ $json.output.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2080,-1168],"id":"907d4a57-b4f0-47ac-8bfc-d66e52091bde","name":"set_atuacao"},{"parameters":{"assignments":{"assignments":[{"id":"089096e6-c00e-485f-8d9a-b7904e041b8e","name":"output.industrias","value":"={{ $json.output.industrias }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5168,-1168],"id":"3e5b5922-03ff-4768-acc2-fdfa179f9291","name":"set_industria"},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[4128,-864],"id":"3b093a20-b66f-42cd-83b3-3ae1801dde9f","name":"Structured Output Parser15"},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[3936,-1760],"id":"3d3bc154-b037-45dc-838b-1d20aeb9f80f","name":"identifica_industria3","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[3904,-832],"id":"86cff299-e542-4c39-accf-f49d5f459150","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[3904,-1168],"id":"298f67f3-b8a4-4a90-af35-9e5e634dc35e","name":"Identifica_industria","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"jsCode":"// Remove caracteres nulos (\\u0000) de qualquer campo do JSON\nfunction clean(obj) {\n  if (typeof obj === \"string\") {\n    // Remove todos os caracteres nulos da string\n    return obj.replace(/\\u0000/g, \"\");\n  }\n\n  if (Array.isArray(obj)) {\n    // Limpa cada item do array\n    return obj.map(clean);\n  }\n\n  if (obj !== null && typeof obj === \"object\") {\n    // Limpa cada chave do objeto\n    const sanitized = {};\n    for (const key of Object.keys(obj)) {\n      sanitized[key] = clean(obj[key]);\n    }\n    return sanitized;\n  }\n\n  // Valores que não são string/objeto/array permanecem iguais\n  return obj;\n}\n\n// Aplica a limpeza ao JSON inteiro do item atual\nreturn [\n  {\n    json: clean(items[0].json)\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[5616,-1168],"id":"d07b99b9-edae-48e6-a711-307002b8ce4f","name":"Code in JavaScript"},{"parameters":{"assignments":{"assignments":[{"id":"801196e7-4116-4eb9-ad10-6ff4ea1ca354","name":"industrias","value":"={{ $json.output }}","type":"object"},{"id":"b5f5c1f6-5d84-4dac-9145-e1824e789003","name":"clientes","value":"={{ $('set_clients').item.json.output }}","type":"object"},{"id":"d9f12ce0-ce72-4891-87de-b62eb0f040fb","name":"actuacao","value":"={{ $('set_atuacao').item.json.output }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5376,-1168],"id":"e055b45a-365a-4a4c-8ed4-ee85631af5c2","name":"Edit Fields"}],"connections":{"Structured Output Parser":{"ai_outputParser":[[{"node":"find_company_website","type":"ai_outputParser","index":0}]]},"Structured Output Parser3":{"ai_outputParser":[[{"node":"resumo_atuacao","type":"ai_outputParser","index":0}]]},"Structured Output Parser5":{"ai_outputParser":[[{"node":"busca_clientes","type":"ai_outputParser","index":0}]]},"busca_google":{"main":[[{"node":"find_company_website1","type":"main","index":0}]]},"find_company_website":{"main":[[{"node":"encontrou_site?","type":"main","index":0}],[{"node":"find_company_website2","type":"main","index":0}]]},"merge_clienteNmain":{"main":[[{"node":"textos_site","type":"main","index":0}]]},"resumo_atuacao":{"main":[[{"node":"set_atuacao","type":"main","index":0}],[{"node":"resumo_atuacao1","type":"main","index":0}]]},"busca_clientes":{"main":[[{"node":"set_clients","type":"main","index":0}],[{"node":"busca_clientes1","type":"main","index":0}]]},"find_client_page":{"main":[[{"node":"get_cliente","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_home","type":"main","index":0}],[]]},"textos_site":{"main":[[{"node":"resumo_atuacao","type":"main","index":0}]]},"get_cliente":{"main":[[{"node":"limpa_cliente","type":"main","index":0}]]},"get_portifolio":{"main":[[{"node":"limpa_portifolio","type":"main","index":0}]]},"get_home":{"main":[[{"node":"limpa_home","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Serper_search","type":"main","index":0}]]},"Serper_search":{"main":[[{"node":"busca_google","type":"main","index":0}]]},"encontrou_site?":{"main":[[{"node":"site_nãoEncontrado","type":"main","index":0}],[{"node":"acessa_site_oficial","type":"main","index":0}]]},"acessa_site_oficial":{"main":[[{"node":"extrai_info_site","type":"main","index":0}]]},"extrai_info_site":{"main":[[{"node":"find_client_page1","type":"main","index":0}]]},"limpa_cliente":{"main":[[{"node":"merge_clienteNmain","type":"main","index":0}]]},"limpa_portifolio":{"main":[[{"node":"merge_clienteNmain","type":"main","index":1}]]},"limpa_home":{"main":[[{"node":"merge_clienteNmain","type":"main","index":2}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"find_company_website","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"find_client_page","type":"ai_languageModel","index":0},{"node":"Structured Output Parser4","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"find_company_website1","type":"ai_outputParser","index":0}]]},"Structured Output Parser2":{"ai_outputParser":[[{"node":"find_company_website2","type":"ai_outputParser","index":0}]]},"find_company_website1":{"main":[[{"node":"encontrou_site?","type":"main","index":0}],[{"node":"find_company_website","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"find_company_website1","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model":{"ai_languageModel":[[{"node":"find_company_website2","type":"ai_languageModel","index":0}]]},"find_company_website2":{"main":[[{"node":"encontrou_site?","type":"main","index":0}]]},"Structured Output Parser7":{"ai_outputParser":[[{"node":"find_client_page1","type":"ai_outputParser","index":0}]]},"Structured Output Parser8":{"ai_outputParser":[[{"node":"find_client_page2","type":"ai_outputParser","index":0}]]},"find_client_page1":{"main":[[{"node":"get_cliente","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_home","type":"main","index":0}],[{"node":"find_client_page2","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"find_client_page1","type":"ai_languageModel","index":0},{"node":"Structured Output Parser7","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model1":{"ai_languageModel":[[{"node":"find_client_page2","type":"ai_languageModel","index":0},{"node":"Structured Output Parser8","type":"ai_languageModel","index":0}]]},"find_client_page2":{"main":[[{"node":"get_home","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_cliente","type":"main","index":0}],[{"node":"find_client_page","type":"main","index":0}]]},"Structured Output Parser4":{"ai_outputParser":[[{"node":"find_client_page","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"resumo_atuacao","type":"ai_languageModel","index":0}]]},"Structured Output Parser9":{"ai_outputParser":[[{"node":"resumo_atuacao1","type":"ai_outputParser","index":0}]]},"Structured Output Parser10":{"ai_outputParser":[[{"node":"resumo_atuacao2","type":"ai_outputParser","index":0}]]},"resumo_atuacao1":{"main":[[{"node":"set_atuacao","type":"main","index":0}],[{"node":"resumo_atuacao2","type":"main","index":0}]]},"Structured Output Parser11":{"ai_outputParser":[[{"node":"busca_clientes1","type":"ai_outputParser","index":0}]]},"Structured Output Parser12":{"ai_outputParser":[[{"node":"busca_clientes2","type":"ai_outputParser","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[{"node":"busca_clientes2","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model5":{"ai_languageModel":[[{"node":"resumo_atuacao2","type":"ai_languageModel","index":0}]]},"busca_clientes1":{"main":[[{"node":"set_clients","type":"main","index":0}],[{"node":"busca_clientes2","type":"main","index":0}]]},"xAI Grok Chat Model2":{"ai_languageModel":[[{"node":"busca_clientes1","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model3":{"ai_languageModel":[[{"node":"resumo_atuacao1","type":"ai_languageModel","index":0}]]},"resumo_atuacao2":{"main":[[{"node":"set_atuacao","type":"main","index":0}]]},"busca_clientes2":{"main":[[{"node":"set_clients","type":"main","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"busca_clientes","type":"ai_languageModel","index":0}]]},"Structured Output Parser13":{"ai_outputParser":[[{"node":"identifica_industria1","type":"ai_outputParser","index":0}]]},"Structured Output Parser14":{"ai_outputParser":[[{"node":"identifica_industria2","type":"ai_outputParser","index":0}]]},"identifica_industria1":{"main":[[{"node":"set_industria","type":"main","index":0}],[{"node":"identifica_industria2","type":"main","index":0}]]},"identifica_industria2":{"main":[[{"node":"set_industria","type":"main","index":0}]]},"xAI Grok Chat Model4":{"ai_languageModel":[[{"node":"identifica_industria1","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"identifica_industria2","type":"ai_languageModel","index":0}]]},"set_clients":{"main":[[{"node":"Identifica_industria","type":"main","index":0}]]},"set_atuacao":{"main":[[{"node":"busca_clientes","type":"main","index":0}]]},"set_industria":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Structured Output Parser15":{"ai_outputParser":[[{"node":"Identifica_industria","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"Identifica_industria","type":"ai_languageModel","index":0}]]},"identifica_industria3":{"main":[[],[]]},"Identifica_industria":{"main":[[{"node":"set_industria","type":"main","index":0}],[{"node":"identifica_industria1","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"update_empresa","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-kpc3-buscafornecedor.up.railway.app","user-agent":"axios/1.12.0","content-length":"1311","accept":"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"162.220.234.108","x-forwarded-host":"primary-kpc3-buscafornecedor.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/us-east4-eqdc4a","x-railway-request-id":"liJ1Lu9fT9GYr1I1woOzXw","x-real-ip":"162.220.234.108","x-request-start":"1764680662393"},"params":{},"query":{},"body":{"data":{"cnpj":null,"razao_social":"TECHNOFAN EQUIPAMENTOS E SERVICOS LTDA","nome_fantasia":null,"matriz_filial":"1","situacao_cadastral":"02","data_inicio_atividades":"19950823","natureza_juridica":"2062","porte_empresa":"05","cnae_fiscal_principal_codigo":"2823200","cnae_fiscal_principal_nome":"Fabricação de máquinas e aparelhos de refrigeração e ventilação para uso industrial e comercial, peças e acessórios","uf":"SP","nome_municipio":"SAO BERNARDO DO CAMPO","site":null,"todos_codigos_cnae":"2823200, 2829199, 3314707, 3321000, 7119703","todos_nomes_cnae":"2823200 - Fabricação de máquinas e aparelhos de refrigeração e ventilação para uso industrial e comercial, peças e acessórios; 2829199 - Fabricação de outras máquinas e equipamentos de uso geral não especificados anteriormente, peças e acessórios; 3314707 - Manutenção e reparação de máquinas e aparelhos de refrigeração e ventilação para uso industrial e comercial; 3321000 - Instalação de máquinas e equipamentos industriais; 7119703 - Serviços de desenho técnico relacionados à arquitetura e engenharia","cnpj_basico":"00819143","cnpj_ordem":"0001","cnpj_dv":"20","cnae_fiscal_secundaria_str":"2829199,3314707,3321000,7119703","clientes":null,"correio_eletronico":null,"capital_social_str":"100000,00"}},"webhookUrl":"https://primary-kpc3-buscafornecedor.up.railway.app/webhook/3cb44ad0-3cd0-4ffa-8193-1d009acc8628","executionMode":"production"}}]},"versionId":"7528f663-bd2d-426c-ac99-c7f8cbd33b49","activeVersionId":"7528f663-bd2d-426c-ac99-c7f8cbd33b49","triggerCount":1,"shared":[{"updatedAt":"2025-10-02T13:46:39.454Z","createdAt":"2025-10-02T13:46:39.454Z","role":"workflow:owner","workflowId":"MLug4tKPxn16X5pv","projectId":"jk0yZKautC5L7CBp"}],"activeVersion":{"updatedAt":"2025-12-02T16:39:03.664Z","createdAt":"2025-12-02T16:39:03.664Z","versionId":"7528f663-bd2d-426c-ac99-c7f8cbd33b49","workflowId":"MLug4tKPxn16X5pv","nodes":[{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-2768,-816],"id":"49128f28-0b2a-4d67-8871-d9a5708ad0e3","name":"Structured Output Parser"},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1024,-992],"id":"320c4946-17a8-42c6-830d-22db96b8babf","name":"Structured Output Parser3"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2400,-976],"id":"250c1a14-fbc7-4a0f-bee2-cddb3f66cd67","name":"Structured Output Parser5"},{"parameters":{"assignments":{"assignments":[{"id":"2eb1014d-2a4f-4fb0-8882-2dd3fb33ac1a","name":"data","value":"={{ $json.organic }}","type":"string"}]},"options":{"ignoreConversionErrors":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3568,-1152],"id":"285f5a4f-2ba0-4005-9b3b-73262f47d0dc","name":"busca_google"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $('busca_google').item.json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**Rejeite:**\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n\n## Formato de Resposta\n\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\"\n}\n```"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-2928,-1024],"id":"70a83992-38db-46cb-a5fe-e4fdb4f14938","name":"find_company_website","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[448,-1184],"id":"37d7389e-0d7a-4815-ae11-1afe1c450d70","name":"merge_clienteNmain"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $json.texto_page_home }}\n\nTexto Page Cliente: {{ $json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[832,-1168],"id":"f75a6fd6-bc30-474a-a66e-02579ca0e79b","name":"resumo_atuacao","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[2256,-1168],"id":"28f85ac1-177d-4954-8f04-f2ad8ffc183b","name":"busca_clientes","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-592,-752],"id":"a789761f-2e27-40bb-a202-3514a747d6de","name":"find_client_page","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"0fdc91d3-9fcc-4761-a907-6d80b362a03c","name":"texto_page_cliente","value":"={{ $json.fullCleanedStringCliente }}","type":"string"},{"id":"37a2eff7-d35e-48be-ad84-28f68a21851b","name":"texto_page_potifolio","value":"={{ $json.fullCleanedStringPortifolio }}","type":"string"},{"id":"69c34852-62c4-4f4d-82a7-bc5d4dae0149","name":"texto_page_home","value":"={{ $json.fullCleanedStringHome }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[576,-1168],"id":"7f62eef3-affd-4f7e-8a4c-31376b10218e","name":"textos_site"},{"parameters":{"content":"## Chama uma API externa:\n- Passa a razão social como parâmetro\n- Encontra possíveis sites para a empresa","height":304,"width":432,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3824,-1296],"id":"248a2455-9637-407b-a2a4-d39ce13116bf","name":"Sticky Note22"},{"parameters":{"url":"={{ $json.output.link_clientes }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-1376],"id":"4f88d481-f864-4d14-be1b-9157a65fadd9","name":"get_cliente","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.output.link_portfolio }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-1168],"id":"95f168ff-7723-461a-9537-14176b81c1a8","name":"get_portifolio","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"url":"={{ $json.output.link_home}}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"redirect":{"redirect":{}},"timeout":20000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-32,-960],"id":"fa7e66fc-1bc3-4020-93b9-f209ab81db9a","name":"get_home","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"path":"3cb44ad0-3cd0-4ffa-8193-1d009acc8628","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-3936,-1152],"id":"360e24b4-b203-4258-832b-5c748a708e9c","name":"Webhook","webhookId":"3cb44ad0-3cd0-4ffa-8193-1d009acc8628"},{"parameters":{"method":"POST","url":"https://google.serper.dev/search","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"2b57e8bc097d1367753763457b13c8d774fd68e9"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"q","value":"={{ $json.body.data.razao_social }}"},{"name":"gl","value":"br"},{"name":"hl","value":"pt-br"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3760,-1152],"id":"37f423bb-a797-4a0b-a38b-589673ed6615","name":"Serper_search","retryOnFail":true},{"parameters":{"content":"## IA: Define qual o site oficial da empresa.\n\n- Recebe os sites encontrados na busca.\n- Recebe informações cadastrais da empresa buscada.\n- Define qual dentre os sites recebidos é o site oficial da empresa.\n- Caso não encontre o site o banco é atualizado.\n\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```","height":976,"width":1248,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-3376,-1520],"id":"36397d93-cce6-400c-97f2-42720a7ab553","name":"Sticky Note24"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.output.site }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"equals"},"id":"41e6c94e-ffa6-4367-a21d-007867c2b030"}],"combinator":"and"},"renameOutput":true,"outputKey":"site_nao_encontrado"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1f1b15d1-c2eb-4b5f-a921-63bae2dfa299","leftValue":"={{ $json.output.site }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"site_encontrado"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2112,-1136],"id":"28cf35b0-0e74-4f36-997e-a9d0b181e40f","name":"encontrou_site?"},{"parameters":{"useCustomSchema":true,"schema":"cnpj_db","operation":"update","tableId":"estabelecimento","matchType":"allFilters","filters":{"conditions":[{"keyName":"cnpj_basico","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_basico }}"},{"keyName":"cnpj_dv","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_dv }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"site","fieldValue":"={{ $json.output.site }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1840,-1264],"id":"e3264e5e-2e24-48b9-a05d-54f16afbaf57","name":"site_nãoEncontrado","credentials":{"supabaseApi":{"id":"iSQjasVk6wzJgBch","name":"Supabase account"}}},{"parameters":{"url":"={{ $json.output.site }}","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"{\n  \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\",\n  \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",\n  \"Accept-Language\": \"pt-BR,pt;q=0.9,en-US;q=0.8\",\n  \"Accept-Encoding\": \"gzip, deflate, br\",\n  \"Connection\": \"keep-alive\",\n  \"Upgrade-Insecure-Requests\": \"1\",\n  \"Referer\": \"https://www.google.com/\",\n  \"Sec-Fetch-Site\": \"none\",\n  \"Sec-Fetch-Mode\": \"navigate\",\n  \"Sec-Fetch-User\": \"?1\",\n  \"Sec-Fetch-Dest\": \"document\",\n  \"DNT\": \"1\"\n}","options":{"allowUnauthorizedCerts":true,"timeout":5000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1856,-976],"id":"1f2ec90f-1065-4dc8-a8d7-075301bbd855","name":"acessa_site_oficial","retryOnFail":true,"maxTries":3,"alwaysOutputData":true,"waitBetweenTries":1500,"onError":"continueRegularOutput"},{"parameters":{"operation":"extractHtmlContent","extractionValues":{"values":[{"key":"links","cssSelector":"a","returnValue":"attribute","attribute":"href","returnArray":true}]},"options":{"trimValues":true}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-1664,-976],"id":"90cca218-09a7-4c03-84e8-5515df3dae45","name":"extrai_info_site","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"content":"## Chama uma API externa:\n- Acessa o HTML do site da empresa.\n- Extrai Links da página","height":304,"width":416,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1920,-1104],"id":"5b09937f-4824-444f-88cf-2936943deb6d","name":"Sticky Note23"},{"parameters":{"content":"## Banco de dados:\n- Atualiza o site da empresa para \"nao_encontrado\"","height":240,"width":256,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1920,-1360],"id":"9a2001ce-6d13-46c3-8177-1630b4261a9d","name":"Sticky Note21"},{"parameters":{"content":"## IA: Busca Páginas.\n- Realiza uma busca entre os links.\n\n- Encontra paginas de:\n-- cliente\n-- portifolio\n-- home\n\n```json\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\n```","height":1440,"width":1376,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1488,-1552],"id":"a4a090bc-aadd-48b5-a5c2-e71ce4e1407f","name":"Sticky Note25"},{"parameters":{"content":"## Chama uma API externa:\n- Acessa paginas de portifolio, cliente e home.\n- Extrai informações dos htmls dessas páginas","height":752,"width":784,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-96,-1552],"id":"672e854d-e6e3-4492-b5ae-1aac5164720e","name":"Sticky Note26"},{"parameters":{"content":"## IA: Resume Atuação.\n- Acessa os dados de home e página de clientes.\n- baseado nessas informações define um resumo da atuação da empresa.\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```","height":960,"width":1488,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[704,-1520],"id":"8ea6a6f6-9f89-40bb-8470-ad1f6485273b","name":"Sticky Note"},{"parameters":{"content":"## IA: Busca Clientes\n- Acessa os dados de home e página de clientes.\n- baseado nessas informações procura possíveis cientes relevantes da empresa.\n\n```json\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n```","height":848,"width":1632,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2208,-1408],"id":"06dfb578-5475-4f29-be40-b96ba182ca4e","name":"Sticky Note1"},{"parameters":{"content":"## IA: Identifica Industria\n- Acessa os dados da página de clientes.\n- baseado nessas informações define o segmento industrial da empresa.\n\n```json\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n```","height":1056,"width":1456,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3856,-1616],"id":"c619d71c-1d02-48a6-9b45-926f8ddec698","name":"Sticky Note2"},{"parameters":{"content":"## Banco de dados:\n- Atualiza o banco da empresa com as informações coletadas.","height":272,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[5552,-1296],"id":"dcb980c8-bca1-4236-ac82-db732f30f042","name":"Sticky Note27"},{"parameters":{"useCustomSchema":true,"schema":"cnpj_db","operation":"update","tableId":"estabelecimento","matchType":"allFilters","filters":{"conditions":[{"keyName":"cnpj_basico","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_basico }}"},{"keyName":"cnpj_dv","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_dv }}"},{"keyName":"cnpj_ordem","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.cnpj_ordem }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"clientes","fieldValue":"={{ $json.clientes.clientes  || \"nao_encontrado\"}}"},{"fieldId":"site","fieldValue":"={{ $('encontrou_site?').item.json.output.site  || \"nao_encontrado\"}}"},{"fieldId":"resumo_empresa","fieldValue":"={{ $json.actuacao.resumo_empresa || \"nao_encontrado\"}}"},{"fieldId":"segmentos_industriais","fieldValue":"={{ $json.industrias.industrias || \"nao_encontrado\" }}"},{"fieldId":"tipo_fornecedor","fieldValue":"={{ $json.actuacao.tipo_fornecedor || \"nao_encontrado\" }}"},{"fieldId":"especialidades","fieldValue":"={{ $json.actuacao.especialidades || \"nao_encontrado\" }}"},{"fieldId":"exemplo_servico","fieldValue":"={{ $json.actuacao.exemplos_servico || \"nao_encontrado\" }}"},{"fieldId":"categorias_materais","fieldValue":"={{ $json.actuacao.categorias_materiais || \"nao_encontrado\" }}"},{"fieldId":"=telefone","fieldValue":"={{ $json.actuacao.telefone || \"nao_encontrado\" }}"},{"fieldId":"instagram","fieldValue":"={{ $json.actuacao.instagram || \"nao_encontrado\" }}"},{"fieldId":"email","fieldValue":"={{ $json.actuacao.email || \"nao_encontrado\" }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[5856,-1168],"id":"4c50ba98-9ef1-45d4-949d-2e809676c637","name":"update_empresa","credentials":{"supabaseApi":{"id":"iSQjasVk6wzJgBch","name":"Supabase account"}}},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringCliente = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringCliente\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-1376],"id":"262f91b6-3c97-46a2-9e80-f57fe22a895c","name":"limpa_cliente"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringPortifolio = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringPortifolio\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-1168],"id":"1c877166-1040-481d-91c1-3bdd2dc06660","name":"limpa_portifolio"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const data = item.json.data;\n\n  // Garante que o conteúdo seja string\n  const rawHtml = String(data || '');\n\n  // 1. Extrai conteúdo do <body> se existir\n  const bodyMatch = rawHtml.match(/<body\\b[^>]*>([\\s\\S]*?)<\\/body>/i);\n  const coreHtml = bodyMatch ? bodyMatch[1] : rawHtml; // Usar bodyMatch[1] para obter apenas o conteúdo dentro da tag <body>\n\n  // 2. Remove blocos desnecessários\n  const cleaned = coreHtml\n    .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n    .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n    .replace(/<(header|nav|footer|aside|noscript|svg|form|iframe|object|canvas|template)[^>]*>[\\s\\S]*?<\\/\\1>/gi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<meta[^>]*>/gi, '')\n    .replace(/<link[^>]*>/gi, '');\n\n  // 3. Extrai links de imagens e descrições\n  const imageMatches = [...cleaned.matchAll(/<img[^>]*src=[\"']([^\"']+)[\"'](?:[^>]*alt=[\"']([^\"']*)[\"'])?(?:[^>]*title=[\"']([^\"']*)[\"'])?[^>]*>/gi)];\n  const images = imageMatches.map(match => {\n    return {\n      src: match[1],\n      alt: match[2] || null,\n      title: match[3] || null\n    };\n  });\n\n  // 4. Extrai links (href + texto)\n  const linkMatches = [...cleaned.matchAll(/<a[^>]*href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi)];\n  const links = linkMatches.map(match => ({\n    href: match[1],\n    text: match[2].replace(/<[^>]+>/g, '').trim()\n  }));\n\n  // 5. Extrai texto visível do conteúdo limpo\n  const textClean = cleaned\n    .replace(/<[^>]+>/g, '')            // remove qualquer tag HTML restante\n    .replace(/\\r\\n?/g, '\\n')            // normaliza quebras de linha\n    .replace(/[ \\t]+\\n/g, '\\n')         // remove espaços antes de \\n\n    .replace(/\\s{2,}/g, ' ')            // reduz espaços múltiplos\n    .replace(/\\n{2,}/g, '\\n')           // reduz linhas vazias\n    .trim();\n\n  // 6. Concatena tudo em uma única string\n  const fullCleanedStringHome = [\n    textClean,\n    '\\n\\n[IMAGENS]',\n    ...images.map(img => `Imagem: ${img.src}\\nAlt: ${img.alt || '—'}\\nTitle: ${img.title || '—'}`),\n    '\\n\\n[LINKS]',\n    ...links.map(link => `Texto: ${link.text}\\nURL: ${link.href}`)\n  ].join('\\n');\n\n  // 7. Retorna\n  return {\n    json: {\n      ...item.json,\n      textClean,\n      images,\n      links,\n      fullCleanedStringHome\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,-960],"id":"9f67e1f1-e458-4cf5-bbd4-dfa2dac7155b","name":"limpa_home"},{"parameters":{"content":"## Limpa o HTML extraído.","height":624,"width":304,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[112,-1440],"id":"7b70b77b-216c-401a-a388-53d334075bf7","name":"Sticky Note36"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-2928,-816],"id":"41fda38a-6eb4-41f8-94ac-9546fbdceede","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-624,-256],"id":"c1df6c72-1df9-4a17-ada1-024d90f648a8","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\",\n    \"site_oficial\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3168,-960],"id":"06e1ac25-40bb-4447-a2e7-f0da4b57ec48","name":"Structured Output Parser1"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador, SerasaExperian)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**NÃO ACEITE DE MANEIRA ALGUMA:**\nRESULTADOS QUE EXIBEM UM DOMINIO ENQUADRADO DENTRO DOS TIPOS ABAIXO SÃO CONSIDERADOS COMO \"NÃO CONFIAVEIS\" E NÃO DEVEM SER RETORNADOS, AO INVÈS DISSO RESPONDA COM \"nao_encontrado\".\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n- `https://econodata.com.br/empresa-xyz` → diretório empresarial sem vínculo institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n- `https://facebook.com/empresa-xyz` → perfil em redes sociais, não institucional.\n(Sites de terceiros NÃO são considerados válidos como site da empresa.)\n\n\n\n## Formato de Resposta\n\nO parametro \"site_oficial\" deve ser \"sim \"\n para sites que com certeza pertencem a empresa em si, não representando sites de terceiros ou menções ou diretórios ou qualquer coisa nesse sentido. Sites que não estão em contro da empresa e são diretórios ou sites de terceitos, devem ter \"site_oficial\" = \"nao\".\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos, não se trata de nenhum diretório ou site de terceiros, é sem sombra de dúvidas o site oficial de controle da empresa..\",\n \"site_oficial\" : \"sim\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\",\n \"site_oficial\" : \"nao\"\n}\n```\n\n\nApenas diretórios, redes sociais, ou marketplaces foram encontrados:\n```json\n{\n\"site\": \"nao_encontrado\",\n\"justificativa\": \"Os domínios https://cnpj.biz/40754585000150\" e \"https://www.econodata.com.br/consulta-empresa/40754585000150-lf-industria-e-comercio-de-esteiras-e-peneiras-metalicas-ltda\" o dominio  representa um diretório empresarial que contém o CNPJ da empresa, não é uma fonte oficial controlada pela empresa logo não é confiável e não deve ser retornado.,\n \"site_oficial\" : \"nao\"\n}\n```\n\nSites confiáveis mas não oficiais de pertencimento da empresa.\n\n```json\n{\n\"site\": \"nao_encontrado\",\n\"justificativa\": \"O site da Serasa Experian \"https://empresas.serasaexperian.com.br/consulta-gratis/LF-INDUSTRIA-E-COMERCIO-DE-ESTEIRAS-E-PENEIRAS-METALICAS-LTDA-40754585000150\", possui informações detalhadas, incluindo endereço em Gravataí, atividade econômica compatível, e o CNPJ correspondente, mas não é um site opficial da empresa.,\n \"site_oficial\" : \"nao\"\n}\n```\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-3328,-1152],"id":"49fdd1d1-3cbe-41b0-a6a3-16e11141f9a6","name":"find_company_website1","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"site\": \"string\",\n\t\"justificativa\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-2384,-688],"id":"2e8fbdd7-5e09-4884-8f9b-04aa2af3beb6","name":"Structured Output Parser2"},{"parameters":{"promptType":"define","text":"=Razao Social: {{ $('Webhook').item.json.body.data.razao_social }}\nNome Fantasia: {{ $('Webhook').item.json.body.data.nome_fantasia }}\nEmail: {{ $('Webhook').item.json.body.data.correio_eletronico }}\nNome Municipio:{{ $('Webhook').item.json.body.data.nome_municipio }}\nCNAES:{{ $('Webhook').item.json.body.data.todos_codigos_cnae }}\nBusca Internet: {{ $('busca_google').item.json.data }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Especialista em Localizar Sites Oficiais de Empresas\n\n## Objetivo\nVocê é um agente especializado em localizar **o site oficial de uma empresa brasileira**, com base em dados cadastrais e resultados de busca. Seu papel é garantir que o site identificado seja **efetivamente controlado pela empresa**, mesmo que o nome da empresa apareça com pequenas variações.\n\n## Informações de entrada\nVocê receberá:\n\n- Nome Fantasia  \n- Razão Social  \n- CNPJ (quando disponível)  \n- Segmento de atuação  \n- CNAE  \n- Cidade  \n- Estado  \n- CEP  \n\n## Estratégia de Busca e Verificação\n\n1. **Busque domínios corporativos próprios**, incluindo sufixos como:  \n   `.com.br`, `.com`, `.net.br`, `.eng.br`, `.ind.br`, `.wixsite.com` (com validação reforçada).\n\n2. **Aceite variações no nome da empresa no domínio**, desde que:\n   - O nome esteja parcialmente presente no domínio (ex: `rubiengenharia.com.br` para \"Rubi Engenharia\").\n   - O conteúdo do site comprove a identidade por outros meios (ver abaixo).\n\n3. **Valide a identidade com base em ao menos duas das evidências abaixo**:\n   - Nome da empresa (ou variação) na seção \"Sobre\", \"Contato\" ou rodapé do site;\n   - Endereço compatível com a cidade ou estado fornecidos;\n   - E-mail corporativo no domínio (ex: contato@empresa.com.br);\n   - Presença de CNPJ ou razão social completa no site;\n   - Perfis oficiais da empresa (Instagram, LinkedIn, etc.) apontando diretamente para o domínio;\n   - Serviços, clientes ou projetos listados que confirmam o segmento informado.\n\n4. **Sites em plataformas como Wix ou WordPress** são aceitáveis **se o conteúdo comprovar a identidade institucional** com base nas evidências acima.\n\n5. Se houver **múltiplos sites candidatos**, selecione o que possuir mais evidências cruzadas de vínculo com a empresa.\n\n## Exclusões Obrigatórias\n\nRejeite os seguintes tipos de páginas, mesmo se mencionarem a empresa:\n\n- Diretórios empresariais (ex: CNPJ.biz, Econodata, TeleListas, Apontador)\n- Sites de marketplaces (ex: OLX, Mercado Livre, Shopee)\n- Sites de releases, notícias ou matérias jornalísticas\n- Blogs ou páginas pessoais que apenas mencionem a empresa\n- Páginas com nomes semelhantes, mas sem qualquer evidência de vínculo com os dados fornecidos\n\n## Exemplos para calibração\n\n**Aceite:**\n- `https://www.brzfire.com.br` → domínio combina com nome fantasia, e-mail institucional aparece no rodapé.\n- `http://www.rubiengenharia.com.br` → nome parcialmente compatível, site descreve serviços de engenharia e localização compatível.\n- `https://ethicusscs.wixsite.com/refrigeracao` → site Wix, mas com nome da empresa, segmento e contato institucional válidos.\n\n**Rejeite:**\n- `https://cnpj.biz/empresa-nome` → diretório empresarial sem vínculo institucional.\n- `https://shopee.com/empresa-xyz` → perfil em marketplace, não institucional.\n\n## Formato de Resposta\n\nSe o site for considerado oficial:\n```json\n{\n  \"site\": \"https://www.nomedasuaempresa.com.br\",\n  \"justificativa\": \"O domínio contém o nome fantasia e o site descreve os serviços, endereço e e-mail institucional compatíveis com os dados fornecidos.\"\n}\n```\n\nSe nenhum site for confiável:\n```json\n{\n  \"site\": \"nao_encontrado\",\n  \"justificativa\": \"Nenhum dos sites encontrados possui evidência suficiente de pertencimento à empresa. Todos são diretórios, domínios genéricos ou menções indiretas.\"\n}\n```"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-2544,-896],"id":"38d8657e-36ff-4af8-8cde-ece4e3a2f1cc","name":"find_company_website2","retryOnFail":false,"alwaysOutputData":false,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-3328,-960],"id":"5e0eaca3-0663-45b4-9ee4-0d4f933cef3b","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"model":"grok-4-1-fast-non-reasoning","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[-2544,-688],"id":"612559ff-6a6c-4707-994a-261cdc113cd6","name":"xAI Grok Chat Model","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-1328,-768],"id":"bb295071-3475-4b21-bd32-13100046a863","name":"Structured Output Parser7"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\n\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-1456,-976],"id":"43217b12-53d7-4686-9280-0d00a8599e8b","name":"find_client_page1","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-944,-640],"id":"c9d19a0b-9493-46e6-adca-a00b7efcecc7","name":"Structured Output Parser8"},{"parameters":{"promptType":"define","text":"=Link_origem:{{ $('encontrou_site?').item.json.output.site }}\nLinks_scrape_origem:{{ $json.links }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especialista em análise semântica de URLs de sites empresariais. Seu objetivo é identificar os links mais relevantes que apontam para a página de clientes, o portfólio de produtos/serviços e a home page. Você compreende sinônimos e contextos comuns em diferentes setores de negócio.\n\nVocê recebe como entrada:\n\nLink_origem: O link principal do site analisado.\nLinks_scrape_origem: Uma lista de todos os links extraídos do site de origem.\n\nTask (Tarefa)\nSua tarefa é analisar a lista Links_scrape_origem para identificar e retornar os três links mais prováveis para as seguintes categorias:\n\nLink de Clientes: Uma página que lista ou descreve os clientes da empresa.\n\nLink de Portfólio/Produtos: Uma página que mostra os produtos, serviços, soluções ou cases de sucesso da empresa.\n\nLink da Home Page: O link principal ou de entrada do site.\n\nAction (Ação)\nSiga rigorosamente estas etapas:\n\nPré-processamento:\nSe Links_scrape_origem estiver vazio, retorne o JSON de falha apropriado.\nReconstrua todos os links relativos (ex: /produtos) e âncoras (ex: #cases) para URLs absolutas usando o Link_origem.\nNormalize os links (remova barras no final, converta para minúsculas) e remova todas as duplicatas.\nDescarte links externos (que não pertencem ao domínio do Link_origem).\n\nAnálise e Pontuação (Scoring):\nPara cada link na lista pré-processada, calcule uma pontuação para \"Clientes\" e \"Portfólio\" com base nos termos encontrados no URL. A pontuação é cumulativa.\n\nTermos para Portfólio/Produtos:\n+10 pontos: portfolio, portfólio, cases, produtos, servicos, solucoes (e variações no plural).\n+7 pontos: o-que-fazemos, nossas-solucoes, projetos, realizacoes.\n\nTermos para Clientes:\n+10 pontos: clientes, nossos-clientes, quem-atendemos.\n+7 pontos: parceiros, cases-de-sucesso, quem-confia.\n\nTermos de Penalidade (aplicável a ambas as categorias):\n-5 pontos: blog, noticias, artigos, sobre, empresa.\n-10 pontos: contato, fale-conosco, trabalhe-conosco, author.\n\nDescarte total: Links com login, tel:, mailto:, ou que terminam em extensões de arquivo (.pdf, .jpg, .zip).\n\nSeleção Final:\nLink de Portfólio: Escolha o link com a maior pontuação para \"Portfólio/Produtos\".\nLink de Clientes: Escolha o link com a maior pontuação para \"Clientes\".\nLink da Home Page: Identifique a raiz exata do domínio (ex: https://www.exemplo.com.br/).\n\nRegra de Desempate: Se houver empate na pontuação, prefira o URL com o caminho mais curto (menor número de barras /).\n\nSe nenhum link obtiver pontuação positiva para uma categoria, considere-o \"nao_encontrado\".\n\nExamples (Exemplos)\n\nExemplo 1 (Input):\n\nLink_origem: https://plasmundimt.com.br/\n\nLinks_scrape_origem: ..., https://plasmundimt.com.br/categoria/produtos, ...\n\nExemplo 1 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Nenhum link com termos relevantes para clientes obteve pontuação positiva.\",\n  \"link_portfolio\": \"https://plasmundimt.com.br/categoria/produtos\",\n  \"justificativa_portfolio\": \"Link com pontuação máxima (+10) devido ao termo 'produtos', indicando ser a página de portfólio de produtos.\",\n  \"link_home\": \"https://plasmundimt.com.br/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nExemplo 2 (Input):\n\nLink_origem: https://techsolutions.com/\n\nLinks_scrape_origem: ..., https://techsolutions.com/nossas-solucoes, https://techsolutions.com/clientes-e-parceiros, ...\n\nExemplo 2 (Output Esperado):\n\nJSON\n\n{\n  \"link_clientes\": \"https://techsolutions.com/clientes-e-parceiros\",\n  \"justificativa_clientes\": \"Link com pontuação máxima (+10 para 'clientes', +7 para 'parceiros'), indicando ser a página dedicada a clientes.\",\n  \"link_portfolio\": \"https://techsolutions.com/nossas-solucoes\",\n  \"justificativa_portfolio\": \"Link com pontuação alta (+10) devido ao termo 'solucoes', indicando ser o portfólio de serviços/soluções.\",\n  \"link_home\": \"https://techsolutions.com/\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nResult (Resultado)\nRetorne um único objeto JSON com a estrutura especificada. Seja específico na justificativa, mencionando o termo-chave que levou à escolha e a pontuação ou razão principal.\n\nSe links válidos forem encontrados:\n\nJSON\n\n{\n  \"link_clientes\": \"URL_completo\",\n  \"justificativa_clientes\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_portfolio\": \"URL_completo\",\n  \"justificativa_portfolio\": \"Justificativa baseada no termo e pontuação.\",\n  \"link_home\": \"URL_completo\",\n  \"justificativa_home\": \"Raiz do domínio identificada como home page.\"\n}\nSe não encontrar ou a lista estiver vazia:\n\nJSON\n\n{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Motivo da não localização.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Motivo da não localização.\",\n  \"link_home\": \"URL_completo_se_possivel\",\n  \"justificativa_home\": \"Motivo da não localização.\"\n}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-1024,-832],"id":"9cf4d8d1-ff4a-4cea-bcaa-727588183abc","name":"find_client_page2","retryOnFail":true,"maxTries":2,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-1456,-544],"id":"a264a58a-9bd3-4056-b87e-1627ce494dce","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"model":"grok-4-fast-reasoning","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[-1088,-464],"id":"50e9a086-f120-4a89-b55b-9c0fb074dff9","name":"xAI Grok Chat Model1","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"link_clientes\": \"nao_encontrado\",\n  \"justificativa_clientes\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_portfolio\": \"nao_encontrado\",\n  \"justificativa_portfolio\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\",\n  \"link_home\": \"nao_encontrado\",\n  \"justificativa_home\": \"Não foi possível analisar links pois a lista de Links_scrape_origem está vazia.\"\n}\n","autoFix":true},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-464,-544],"id":"188c1fc7-5b6a-4f84-ada3-6600f55e14c3","name":"Structured Output Parser4"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[752,-960],"id":"28032c10-6da4-41bc-8975-9693149e142f","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1376,-800],"id":"48aabc16-ebb0-4240-8053-f8a03642d368","name":"Structured Output Parser9"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1232,-1024],"id":"7c188261-8278-4370-88a4-83988af3b85c","name":"resumo_atuacao1","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1776,-736],"id":"4b826f48-e939-4bfc-9a56-d3900dee1e8d","name":"Structured Output Parser10"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}\n\nOutras informações do site: {{ $('extrai_info_site').item.json.links }}","hasOutputParser":true,"options":{"systemMessage":"=# Prompt: Agente Gerador de Resumo de Atuação da Empresa\n\nVocê é um agente especializado em gerar resumos objetivos sobre empresas com base no conteúdo de seus sites institucionais.\n\n## Objetivo\n\nSua tarefa é analisar o conteúdo textual do site de uma empresa fornecedora e:\n1. Gerar um resumo com **até 200 caracteres**, explicando **o que a empresa faz**, com ênfase em seus **serviços ou produtos principais**.\n2. Entender se é um fornecedor majoritariamente de serviço ou produto.\n3. Resumir as especialidades do fornecedor.\n4. Quais categorias de materiais ele fornece.\n5. Exemplos de serviço prestado\n6. Pegar telefone do site.\n7. Pegar instagram do site.\n8. Pegar e-mail do site.\n\n## Entrada\n\nAnalise exclusivamente o conteúdo presente no campo `fullCleanedString`.\n\n## Instruções\n\n1. Leia o texto e identifique os principais **produtos**, **serviços**, **tecnologias** ou **segmentos atendidos**.\n2. Foque em responder à pergunta: **“O que esta empresa oferece?”**\n3. Seja direto, objetivo e use linguagem clara e comercial.\n4. Evite termos vagos como “soluções inovadoras” sem explicar o que é oferecido.\n\n\n### Exemplos de resumo aceitável\n\n- `\"Fabricação de estruturas metálicas para galpões industriais e coberturas comerciais.\"`\n- `\"Especializada em engenharia elétrica e montagem de painéis para indústrias.\"`\n- `\"Distribuidora de equipamentos hidráulicos e válvulas industriais em todo o Brasil.\"`\n\n## Saída\n\nRetorne o resultado no seguinte formato JSON:\n\n```json\n{\n  \"resumo_empresa\": \"DESCRIÇÃO RESUMIDA AQUI\",\n  \"tipo_fornecedor\":\"material ou servico\",\n  \"especialidades\":\"detalhar especialidade do fornecedor\",\n  \"exemplos_servico\":\"detalhar exemplo de servicos prestados\",\n  \"categorias_materiais\":\"quais categorias de materiais são fornecidos pelo fornecedor\",\n  \"telefone\":\"12313123123\",\n  \"instagram\":\"@instagram\",\n  \"email\":\"empresa@empresa.com\"\n}\n```\n\nSe não for possível identificar algum dos campos, retorne: nao_encontrado\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1632,-944],"id":"7e65b85e-f530-4199-810d-27031879dd86","name":"resumo_atuacao2","retryOnFail":false,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2944,-784],"id":"df065f47-710b-411d-be8c-48cf7bd47886","name":"Structured Output Parser11"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[2752,-1040],"id":"7fdff420-793a-4b19-9f76-a8a99c0b2a02","name":"busca_clientes1","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n\t\"clientes\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3488,-752],"id":"01844728-4261-4317-8e0b-2247d09ba114","name":"Structured Output Parser12"},{"parameters":{"promptType":"define","text":"=Texto Page Home: {{ $('textos_site').item.json.texto_page_home }}\n\nTexto Page Cliente: {{ $('textos_site').item.json.texto_page_cliente }}","hasOutputParser":true,"options":{"systemMessage":"=Situation (Situação)\nVocê é um agente especializado em analisar o conteúdo textual de sites de fornecedores para identificar nomes de clientes empresariais ou institucionais.\nO objetivo é encontrar empresas ou instituições que tenham recebido serviços, produtos ou atendimentos do fornecedor analisado — e não organizações citadas como parceiras, patrocinadoras, colaboradoras ou apoiadoras.\n\nA análise deve ser feita exclusivamente com base no conteúdo fornecido em fullCleanedString.\n\nTask (Tarefa)\nSua tarefa é:\n\nIdentificar trechos de texto que indiquem prestação de serviços, fornecimento, execução de projetos ou atendimento a clientes.\n\nExtrair nomes de empresas ou instituições que sejam claramente clientes.\n\nEliminar qualquer menção a parcerias, patrocínios, apoios, colaborações, fornecedores ou representantes.\n\nRetornar o resultado em formato JSON, com todos os nomes de clientes válidos.\n\nAction (Ação)\n\nAnálise de contexto\nBusque por blocos de texto que indiquem prestação de serviço, usando expressões como:\n\n\"Clientes\", \"Clientes Atendidos\", \"Nossos Clientes\"\n\n\"Obras realizadas\", \"Projetos entregues\", \"Cases de sucesso\"\n\n\"Portfólio\", \"Quem confia\", \"Empresas atendidas\", \"Trabalhos realizados\", \"Marcas atendidas\"\n\nExtração de clientes\n\nIdentifique nomes de empresas ou instituições que aparecem como beneficiárias diretas dos serviços ou produtos.\n\nEles podem estar em listas, títulos, descrições de projetos ou seções visuais.\n\nQuando houver localizações geográficas, remova-as.\n\nExemplo: \"Grupo DBK - São José do Rio Preto - SP\" → \"Grupo DBK\"\n\nRemova formatações (negrito, colchetes, links, etc.).\n\nFiltragem e limpeza dos resultados\n\nIgnorar menções relacionadas a:\n\nParcerias: “parceiros”, “parceiro comercial”, “colaboração”, “co-branding”.\n\nPatrocínios: “patrocinadores”, “apoiadores”, “iniciativas conjuntas”, “apoio institucional”.\n\nDistribuidores/representantes: “representantes autorizados”, “revendas”, “fornecedores”.\n\nIgnorar também:\n\nTermos técnicos ou genéricos (ex: “Tubulação industrial”, “Serviço de pintura”).\n\nCidades ou regiões isoladas.\n\nFrases genéricas (“clientes satisfeitos”, “diversas empresas”).\n\nRepetições, nomes incompletos ou vagos (“Empresa de Logística”).\n\nFormatação final\n\nOrganize os nomes únicos em uma única string, separados por vírgulas.\n\nNão adivinhe nem complete nomes parcialmente.\n\nRetorne apenas empresas com indícios claros de relação cliente → fornecedor.\n\nResult (Resultado)\n\nSe um ou mais nomes válidos forem identificados:\n\n{\n  \"clientes\": \"Grupo DBK, Quinelato, Plakton Cosméticos\"\n}\n\n\nSe nenhum cliente válido for identificado:\n\n{\n  \"clientes\": \"nao_encontrado\"\n}\n\n\nRegras finais:\n\nA saída deve conter apenas o campo \"clientes\" com uma string separada por vírgulas.\n\nNunca inferir, completar ou supor nomes.\n\nEliminar duplicações, formatações e dados irrelevantes.\n\nJamais considerar parceiros, patrocinadores, apoiadores, fornecedores ou distribuidores como clientes."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[3280,-928],"id":"65a2de16-59f2-43ee-9b75-03230d74a1b0","name":"busca_clientes2","retryOnFail":true,"maxTries":3,"onError":"continueErrorOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[3264,-736],"id":"7b8873c6-9512-41bf-84c6-f4de72d247b7","name":"Google Gemini Chat Model6","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[1600,-736],"id":"2603e0ad-d98d-4b78-a543-f78da23c67f7","name":"Google Gemini Chat Model5","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[2720,-816],"id":"0ee26ceb-6cd1-4b8f-ac2e-15e96b82d976","name":"xAI Grok Chat Model2","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[1232,-800],"id":"0d71c92c-3ca8-4ce2-85b7-9652bbd870e7","name":"xAI Grok Chat Model3","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[2240,-960],"id":"839429d9-8917-4e45-b12d-1683006cf4c2","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[4544,-816],"id":"ac036a8a-a5d0-492b-af85-35fa52a9a1a8","name":"Structured Output Parser13"},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $('set_clients').item.json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[4368,-1056],"id":"2f242892-ad82-4357-a6db-cba08e74b0dd","name":"identifica_industria1","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[5024,-752],"id":"cbdf5f91-3d18-4af3-8f98-cdbac4c79e4e","name":"Structured Output Parser14"},{"parameters":{"promptType":"define","text":"=Clientes: {{ $('set_clients').item.json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[4816,-928],"id":"f7336017-d718-448d-88a7-8211ab429c84","name":"identifica_industria2","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatXAiGrok","typeVersion":1,"position":[4352,-816],"id":"339a182e-883d-4cbc-ab6e-42bd87a83a4e","name":"xAI Grok Chat Model4","credentials":{"xAiApi":{"id":"zcxLRMJuj2WFdlT7","name":"xAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[4784,-720],"id":"c5971adf-4b52-4a1e-8052-c6c8f0e28f5d","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"assignments":{"assignments":[{"id":"7f68dea5-0451-4f58-bddf-330841d32c45","name":"output.clientes","value":"={{ $json.output.clientes }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3728,-1168],"id":"433e5595-565f-460e-9b26-416eec2b73c8","name":"set_clients"},{"parameters":{"assignments":{"assignments":[{"id":"ae01ea4e-3b10-4c32-b69f-16f824c9e221","name":"output.resumo_empresa","value":"={{ $json.output.resumo_empresa }}","type":"string"},{"id":"b2a6e0d2-37d9-47f9-93bf-b2f0e63d52a8","name":"output.tipo_fornecedor","value":"={{ $json.output.tipo_fornecedor }}","type":"string"},{"id":"94c372d3-8989-4039-9ab4-34f3ec0926e9","name":"output.especialidades","value":"={{ $json.output.especialidades }}","type":"string"},{"id":"1507e688-1b94-48b4-98fb-76e46a8d6f41","name":"output.exemplos_servico","value":"={{ $json.output.exemplos_servico }}","type":"string"},{"id":"d75c69c3-dbe4-47cc-a8b8-0f0787a32bae","name":"output.categorias_materiais","value":"={{ $json.output.categorias_materiais }}","type":"string"},{"id":"9ef619cb-9d11-49dc-bb40-b355fa2f9368","name":"output.telefone","value":"={{ $json.output.telefone }}","type":"string"},{"id":"d655ae9a-70b4-4ecb-bb4e-fb440b97f6e1","name":"output.instagram","value":"={{ $json.output.instagram }}","type":"string"},{"id":"c3794956-d929-48e0-9500-d0ace027d8cf","name":"output.email","value":"={{ $json.output.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2080,-1168],"id":"907d4a57-b4f0-47ac-8bfc-d66e52091bde","name":"set_atuacao"},{"parameters":{"assignments":{"assignments":[{"id":"089096e6-c00e-485f-8d9a-b7904e041b8e","name":"output.industrias","value":"={{ $json.output.industrias }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5168,-1168],"id":"3e5b5922-03ff-4768-acc2-fdfa179f9291","name":"set_industria"},{"parameters":{"jsonSchemaExample":"{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[4128,-864],"id":"3b093a20-b66f-42cd-83b3-3ae1801dde9f","name":"Structured Output Parser15"},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"=Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[3936,-1760],"id":"3d3bc154-b037-45dc-838b-1d20aeb9f80f","name":"identifica_industria3","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"builtInTools":{},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[3904,-832],"id":"86cff299-e542-4c39-accf-f49d5f459150","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"g2eqCZ5ZlxiAjjhU","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=Clientes:  {{ $json.output.clientes }}","hasOutputParser":true,"options":{"systemMessage":"Papel: Você é um agente especialista em encontrar clientes que são industrias.\nObjetivo: Identificar segmentos industriais de uma lista de clientes.\nTarefa: Analise a lista de Clientes e identifique segmentos industriais que atuam.\nExemplos: \nNestle - Industria de Alimentos\nVotorantim Cimentos - Industria de Cimentos\nPeccin - Industria de Alimentos\nAmbev - Industria de Bebidas\nBracell - Industria Papel e Celulose\n\nFormato de Saída\nJSON\n{\n  \"industrias\":\"Industria de Alimentos, Industria Papel e Celulose, ... \"\n}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[3904,-1168],"id":"298f67f3-b8a4-4a90-af35-9e5e634dc35e","name":"Identifica_industria","retryOnFail":true,"onError":"continueErrorOutput"},{"parameters":{"jsCode":"// Remove caracteres nulos (\\u0000) de qualquer campo do JSON\nfunction clean(obj) {\n  if (typeof obj === \"string\") {\n    // Remove todos os caracteres nulos da string\n    return obj.replace(/\\u0000/g, \"\");\n  }\n\n  if (Array.isArray(obj)) {\n    // Limpa cada item do array\n    return obj.map(clean);\n  }\n\n  if (obj !== null && typeof obj === \"object\") {\n    // Limpa cada chave do objeto\n    const sanitized = {};\n    for (const key of Object.keys(obj)) {\n      sanitized[key] = clean(obj[key]);\n    }\n    return sanitized;\n  }\n\n  // Valores que não são string/objeto/array permanecem iguais\n  return obj;\n}\n\n// Aplica a limpeza ao JSON inteiro do item atual\nreturn [\n  {\n    json: clean(items[0].json)\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[5616,-1168],"id":"d07b99b9-edae-48e6-a711-307002b8ce4f","name":"Code in JavaScript"},{"parameters":{"assignments":{"assignments":[{"id":"801196e7-4116-4eb9-ad10-6ff4ea1ca354","name":"industrias","value":"={{ $json.output }}","type":"object"},{"id":"b5f5c1f6-5d84-4dac-9145-e1824e789003","name":"clientes","value":"={{ $('set_clients').item.json.output }}","type":"object"},{"id":"d9f12ce0-ce72-4891-87de-b62eb0f040fb","name":"actuacao","value":"={{ $('set_atuacao').item.json.output }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5376,-1168],"id":"e055b45a-365a-4a4c-8ed4-ee85631af5c2","name":"Edit Fields"}],"connections":{"Structured Output Parser":{"ai_outputParser":[[{"node":"find_company_website","type":"ai_outputParser","index":0}]]},"Structured Output Parser3":{"ai_outputParser":[[{"node":"resumo_atuacao","type":"ai_outputParser","index":0}]]},"Structured Output Parser5":{"ai_outputParser":[[{"node":"busca_clientes","type":"ai_outputParser","index":0}]]},"busca_google":{"main":[[{"node":"find_company_website1","type":"main","index":0}]]},"find_company_website":{"main":[[{"node":"encontrou_site?","type":"main","index":0}],[{"node":"find_company_website2","type":"main","index":0}]]},"merge_clienteNmain":{"main":[[{"node":"textos_site","type":"main","index":0}]]},"resumo_atuacao":{"main":[[{"node":"set_atuacao","type":"main","index":0}],[{"node":"resumo_atuacao1","type":"main","index":0}]]},"busca_clientes":{"main":[[{"node":"set_clients","type":"main","index":0}],[{"node":"busca_clientes1","type":"main","index":0}]]},"find_client_page":{"main":[[{"node":"get_cliente","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_home","type":"main","index":0}],[]]},"textos_site":{"main":[[{"node":"resumo_atuacao","type":"main","index":0}]]},"get_cliente":{"main":[[{"node":"limpa_cliente","type":"main","index":0}]]},"get_portifolio":{"main":[[{"node":"limpa_portifolio","type":"main","index":0}]]},"get_home":{"main":[[{"node":"limpa_home","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Serper_search","type":"main","index":0}]]},"Serper_search":{"main":[[{"node":"busca_google","type":"main","index":0}]]},"encontrou_site?":{"main":[[{"node":"site_nãoEncontrado","type":"main","index":0}],[{"node":"acessa_site_oficial","type":"main","index":0}]]},"acessa_site_oficial":{"main":[[{"node":"extrai_info_site","type":"main","index":0}]]},"extrai_info_site":{"main":[[{"node":"find_client_page1","type":"main","index":0}]]},"limpa_cliente":{"main":[[{"node":"merge_clienteNmain","type":"main","index":0}]]},"limpa_portifolio":{"main":[[{"node":"merge_clienteNmain","type":"main","index":1}]]},"limpa_home":{"main":[[{"node":"merge_clienteNmain","type":"main","index":2}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"find_company_website","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"find_client_page","type":"ai_languageModel","index":0},{"node":"Structured Output Parser4","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"find_company_website1","type":"ai_outputParser","index":0}]]},"Structured Output Parser2":{"ai_outputParser":[[{"node":"find_company_website2","type":"ai_outputParser","index":0}]]},"find_company_website1":{"main":[[{"node":"encontrou_site?","type":"main","index":0}],[{"node":"find_company_website","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"find_company_website1","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model":{"ai_languageModel":[[{"node":"find_company_website2","type":"ai_languageModel","index":0}]]},"find_company_website2":{"main":[[{"node":"encontrou_site?","type":"main","index":0}]]},"Structured Output Parser7":{"ai_outputParser":[[{"node":"find_client_page1","type":"ai_outputParser","index":0}]]},"Structured Output Parser8":{"ai_outputParser":[[{"node":"find_client_page2","type":"ai_outputParser","index":0}]]},"find_client_page1":{"main":[[{"node":"get_cliente","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_home","type":"main","index":0}],[{"node":"find_client_page2","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"find_client_page1","type":"ai_languageModel","index":0},{"node":"Structured Output Parser7","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model1":{"ai_languageModel":[[{"node":"find_client_page2","type":"ai_languageModel","index":0},{"node":"Structured Output Parser8","type":"ai_languageModel","index":0}]]},"find_client_page2":{"main":[[{"node":"get_home","type":"main","index":0},{"node":"get_portifolio","type":"main","index":0},{"node":"get_cliente","type":"main","index":0}],[{"node":"find_client_page","type":"main","index":0}]]},"Structured Output Parser4":{"ai_outputParser":[[{"node":"find_client_page","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"resumo_atuacao","type":"ai_languageModel","index":0}]]},"Structured Output Parser9":{"ai_outputParser":[[{"node":"resumo_atuacao1","type":"ai_outputParser","index":0}]]},"Structured Output Parser10":{"ai_outputParser":[[{"node":"resumo_atuacao2","type":"ai_outputParser","index":0}]]},"resumo_atuacao1":{"main":[[{"node":"set_atuacao","type":"main","index":0}],[{"node":"resumo_atuacao2","type":"main","index":0}]]},"Structured Output Parser11":{"ai_outputParser":[[{"node":"busca_clientes1","type":"ai_outputParser","index":0}]]},"Structured Output Parser12":{"ai_outputParser":[[{"node":"busca_clientes2","type":"ai_outputParser","index":0}]]},"Google Gemini Chat Model6":{"ai_languageModel":[[{"node":"busca_clientes2","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model5":{"ai_languageModel":[[{"node":"resumo_atuacao2","type":"ai_languageModel","index":0}]]},"busca_clientes1":{"main":[[{"node":"set_clients","type":"main","index":0}],[{"node":"busca_clientes2","type":"main","index":0}]]},"xAI Grok Chat Model2":{"ai_languageModel":[[{"node":"busca_clientes1","type":"ai_languageModel","index":0}]]},"xAI Grok Chat Model3":{"ai_languageModel":[[{"node":"resumo_atuacao1","type":"ai_languageModel","index":0}]]},"resumo_atuacao2":{"main":[[{"node":"set_atuacao","type":"main","index":0}]]},"busca_clientes2":{"main":[[{"node":"set_clients","type":"main","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"busca_clientes","type":"ai_languageModel","index":0}]]},"Structured Output Parser13":{"ai_outputParser":[[{"node":"identifica_industria1","type":"ai_outputParser","index":0}]]},"Structured Output Parser14":{"ai_outputParser":[[{"node":"identifica_industria2","type":"ai_outputParser","index":0}]]},"identifica_industria1":{"main":[[{"node":"set_industria","type":"main","index":0}],[{"node":"identifica_industria2","type":"main","index":0}]]},"identifica_industria2":{"main":[[{"node":"set_industria","type":"main","index":0}]]},"xAI Grok Chat Model4":{"ai_languageModel":[[{"node":"identifica_industria1","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"identifica_industria2","type":"ai_languageModel","index":0}]]},"set_clients":{"main":[[{"node":"Identifica_industria","type":"main","index":0}]]},"set_atuacao":{"main":[[{"node":"busca_clientes","type":"main","index":0}]]},"set_industria":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Structured Output Parser15":{"ai_outputParser":[[{"node":"Identifica_industria","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"Identifica_industria","type":"ai_languageModel","index":0}]]},"identifica_industria3":{"main":[[],[]]},"Identifica_industria":{"main":[[{"node":"set_industria","type":"main","index":0}],[{"node":"identifica_industria1","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"update_empresa","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]}},"authors":"ABC  advise","name":null,"description":null,"autosaved":false},"tags":[{"updatedAt":"2025-10-02T13:53:47.318Z","createdAt":"2025-10-02T13:53:47.318Z","id":"El7C2Bp08WUbNazn","name":"Subworkflow"},{"updatedAt":"2025-10-15T14:40:29.163Z","createdAt":"2025-10-15T14:40:29.163Z","id":"nbbzLv39fl1JNnUB","name":"webhook"}]}