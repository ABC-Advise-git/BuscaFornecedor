{"updatedAt":"2026-01-09T18:29:05.021Z","createdAt":"2025-12-03T16:10:39.770Z","id":"1Gpc88PgeKGsYRmh","name":"popula_empresas_processadas","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-832,192],"id":"b5e574c5-6d6c-4ffd-86f7-57ca4684422b","name":"When clicking ‘Execute workflow’"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"empresas","mode":"list","cachedResultName":"empresas"},"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1312,192],"id":"e8af6807-e49d-45c3-b60c-efbffc8afb27","name":"get_empresas","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"assignments":{"assignments":[{"id":"2d3662b1-f007-438c-8787-31ab50f5d5fd","name":"cnpj_basico","value":"={{ $('get_estabelecimentos').item.json.cnpj_basico }}","type":"string"},{"id":"4db8a685-70d9-4b2f-adaf-043f1d16b280","name":"cnpj_ordem","value":"={{ $('get_estabelecimentos').item.json.cnpj_ordem }}","type":"string"},{"id":"0255f9ee-63be-4573-af2e-d30e63cbedad","name":"cnpj_dv","value":"={{ $('get_estabelecimentos').item.json.cnpj_dv }}","type":"string"},{"id":"2e7aa03b-9d7b-4cd9-b628-b8542ce9468b","name":"razao_social","value":"={{ $json.razao_social }}","type":"string"},{"id":"fecaea6d-a3f1-4e87-b729-34be756e571f","name":"matriz_filial","value":"={{ $('get_estabelecimentos').item.json.matriz_filial }}","type":"string"},{"id":"665903bf-0e9a-4abf-a9c7-88792fbb6d1b","name":"nome_fantasia","value":"={{ $('get_estabelecimentos').item.json.nome_fantasia }}","type":"string"},{"id":"073f3074-70a1-45c3-90df-7fcb1b18af62","name":"situacao_cadastral","value":"={{ $('get_estabelecimentos').item.json.situacao_cadastral }}","type":"string"},{"id":"4841284e-21d9-48c4-b5ff-ebb82fad577c","name":"data_situacao_cadastral","value":"={{ $('get_estabelecimentos').item.json.data_situacao_cadastral }}","type":"string"},{"id":"137cb792-af3f-464d-b470-baa59ddb76c1","name":"motivo_situacao_cadastral","value":"={{ $('get_estabelecimentos').item.json.motivo_situacao_cadastral }}","type":"string"},{"id":"1cfb6ae4-dca2-4dbc-bb8b-ed226bba1469","name":"nome_cidade_exterior","value":"={{ $('get_estabelecimentos').item.json.nome_cidade_exterior }}","type":"string"},{"id":"d1665450-b6ae-4a97-9139-6a08a2c962ae","name":"pais","value":"={{ $('get_estabelecimentos').item.json.pais }}","type":"string"},{"id":"833e9c28-2006-4990-96f0-4ac5c480427f","name":"data_inicio_atividades","value":"={{ $('get_estabelecimentos').item.json.data_inicio_atividades }}","type":"string"},{"id":"c5e4aec2-552a-477c-8997-f28021707eb3","name":"cnae_fiscal","value":"={{ $('get_estabelecimentos').item.json.cnae_fiscal }}","type":"string"},{"id":"9ac0089a-679a-4ace-9cad-ac31cb090228","name":"cnae_fiscal_secundaria","value":"={{ $('get_estabelecimentos').item.json.cnae_fiscal_secundaria }}","type":"string"},{"id":"3e1e2e88-0497-43e9-ba6c-3b4a6142c5ec","name":"tipo_logradouro","value":"={{ $('get_estabelecimentos').item.json.tipo_logradouro }}","type":"string"},{"id":"5e129ce5-0896-4c3f-8433-23e1eac67e6a","name":"logradouro","value":"={{ $('get_estabelecimentos').item.json.logradouro }}","type":"string"},{"id":"9f521cc8-c825-44b8-8b51-080c6876a80b","name":"numero","value":"={{ $('get_estabelecimentos').item.json.numero }}","type":"string"},{"id":"b8af7df4-7677-49c9-a0ff-07247fe8a1be","name":"complemento","value":"={{ $('get_estabelecimentos').item.json.complemento }}","type":"string"},{"id":"825e29a4-2fc7-440c-8eda-143fb24f6172","name":"bairro","value":"={{ $('get_estabelecimentos').item.json.bairro }}","type":"string"},{"id":"8ef2d505-2a96-4e78-99d8-b9c7e2aeb5d5","name":"cep","value":"={{ $('get_estabelecimentos').item.json.cep }}","type":"string"},{"id":"3f5c634c-570c-4929-a569-c344c1fe69d3","name":"uf","value":"={{ $('get_estabelecimentos').item.json.uf }}","type":"string"},{"id":"0817d35f-321e-4129-a01d-a38eb9b66db1","name":"municipio","value":"={{ $('get_estabelecimentos').item.json.municipio }}","type":"string"},{"id":"c9b8cfe9-5279-4230-9dce-900182594855","name":"ddd1","value":"={{ $('get_estabelecimentos').item.json.ddd1 }}","type":"string"},{"id":"96fa016e-5d23-442a-b57f-9ffa8c683145","name":"telefone1","value":"={{ $('get_estabelecimentos').item.json.telefone1 }}","type":"string"},{"id":"21697aad-2469-4034-8697-fd42b838043f","name":"ddd2","value":"={{ $('get_estabelecimentos').item.json.ddd2 }}","type":"string"},{"id":"dc013cc6-e30b-464c-9767-5aa9e41fa1de","name":"telefone2","value":"={{ $('get_estabelecimentos').item.json.telefone2 }}","type":"string"},{"id":"bba925ed-42e3-42fb-bdaf-8805f74b3db7","name":"ddd_fax","value":"={{ $('get_estabelecimentos').item.json.ddd_fax }}","type":"string"},{"id":"953e1581-dcbd-443a-a6a1-29d23d1b2dd2","name":"fax","value":"={{ $('get_estabelecimentos').item.json.fax }}","type":"string"},{"id":"fd50be3c-8e20-4b29-ac64-f1f27778115a","name":"correio_eletronico","value":"={{ $('get_estabelecimentos').item.json.correio_eletronico }}","type":"string"},{"id":"12112c9a-cd5b-4b48-a196-2a68d89c157d","name":"situacao_especial","value":"={{ $('get_estabelecimentos').item.json.situacao_especial }}","type":"string"},{"id":"b216280a-bf3f-44b9-8902-5cf5f30364bf","name":"data_situacao_especial","value":"={{ $('get_estabelecimentos').item.json.data_situacao_especial }}","type":"string"},{"id":"db5a5df6-ba74-48c8-8a7a-cdf6201b826b","name":"site","value":"={{ $('get_estabelecimentos').item.json.site }}","type":"string"},{"id":"5c495d52-5846-4a78-a114-3def87a49c4e","name":"clientes","value":"={{ $('get_estabelecimentos').item.json.clientes }}","type":"string"},{"id":"e119f913-e0e3-4b26-978d-5cc660671313","name":"resumo_empresa","value":"={{ $('get_estabelecimentos').item.json.resumo_empresa }}","type":"string"},{"id":"ef9ca3be-6434-4775-86d1-c80656c7eae7","name":"segmentos_industriais","value":"={{ $('get_estabelecimentos').item.json.segmentos_industriais }}","type":"string"},{"id":"faee5e07-e490-474f-b050-b181b3d55313","name":"tipo_fornecedor","value":"={{ $('get_estabelecimentos').item.json.tipo_fornecedor }}","type":"string"},{"id":"a464cd24-6d28-45a7-93a5-1c129c057acf","name":"especialidades","value":"={{ $('get_estabelecimentos').item.json.especialidades }}","type":"string"},{"id":"c803b786-3fa0-4140-b818-6489f3c9dfd7","name":"exemplo_servico","value":"={{ $('get_estabelecimentos').item.json.exemplo_servico }}","type":"string"},{"id":"8b7d31f5-7cfd-40a2-8cfe-18a8b55154ef","name":"categorias_materais","value":"={{ $('get_estabelecimentos').item.json.categorias_materais }}","type":"string"},{"id":"5d896228-8634-41e5-b849-35337615af1a","name":"telefone","value":"={{ $('get_estabelecimentos').item.json.telefone }}","type":"string"},{"id":"52b0acb4-1fed-4556-89a8-85098c36bc03","name":"email","value":"={{ $('get_estabelecimentos').item.json.email }}","type":"string"},{"id":"31284d11-a4c4-4fa7-9ee2-3fb3d115e3e6","name":"n_exibicoes","value":"={{ $('get_estabelecimentos').item.json.n_exibicoes }}","type":"string"},{"id":"cefa3ebd-44d1-44ed-b48a-5bb77a264472","name":"e-mail_extended","value":"={{ $('get_estabelecimentos').item.json['e-mail_extended'] }}","type":"string"},{"id":"2f2d3136-26e9-49d6-91ef-4818d55ef5f0","name":"recebe_email","value":"={{ $('get_estabelecimentos').item.json.recebe_email }}","type":"boolean"},{"id":"4555c9f2-22b5-4a7b-b13f-8f2b0bb24050","name":"cnae_lista","value":"={{\n  [\n    $('get_estabelecimentos').item.json.cnae_fiscal_secundaria,\n    $('get_estabelecimentos').item.json.cnae_fiscal\n  ]\n  .map(item => item)      // map obrigatório\n  .filter(item => item != null)\n}}\n\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[480,192],"id":"64af95f1-9940-4d92-b926-3c6b35c2d5bb","name":"set_data"},{"parameters":{"method":"POST","url":"https://scraperapi-buscafornecedor.up.railway.app/analyze","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"api-scraper-busca"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"razao_social","value":"={{ $json.razao_social }}"},{"name":"cnpj","value":"={{ $json.cnpj_basico }}{{ $json.cnpj_ordem }}{{ $json.cnpj_dv }}"},{"name":"cnaes","value":"={{ [ $json.cnae_lista ]}}"},{"name":"nome_fantasia","value":"={{ $json.nome_fantasia }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1520,192],"id":"d9fe53e1-6d54-4974-9e74-0043af6d4499","name":"Scraper_api","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"empresas_processadas","mode":"list","cachedResultName":"empresas_processadas"},"columns":{"mappingMode":"defineBelow","value":{"recebe_email":"={{ $('set_data').item.json.recebe_email }}","cnpj_basico":"={{ $('set_data').item.json.cnpj_basico }}","cnpj_ordem":"={{ $('set_data').item.json.cnpj_ordem }}","cnpj_dv":"={{ $('set_data').item.json.cnpj_dv }}","matriz_filial":"={{ $('set_data').item.json.matriz_filial }}","nome_fantasia":"={{ $('set_data').item.json.situacao_cadastral }}","situacao_cadastral":"={{ $('set_data').item.json.situacao_cadastral }}","data_situacao_cadastral":"={{ $('set_data').item.json.data_situacao_cadastral }}","motivo_situacao_cadastral":"={{ $('set_data').item.json.motivo_situacao_cadastral }}","nome_cidade_exterior":"={{ $('set_data').item.json.nome_cidade_exterior }}","pais":"={{ $('set_data').item.json.pais }}","data_inicio_atividades":"={{ $('set_data').item.json.data_inicio_atividades }}","cnae_fiscal":"={{ $('set_data').item.json.cnae_fiscal }}","cnae_fiscal_secundaria":"={{ $('set_data').item.json.cnae_fiscal_secundaria }}","tipo_logradouro":"={{ $('set_data').item.json.tipo_logradouro }}","logradouro":"={{ $('set_data').item.json.logradouro }}","numero":"={{ $('set_data').item.json.numero }}","complemento":"={{ $('set_data').item.json.complemento }}","bairro":"={{ $('set_data').item.json.bairro }}","cep":"={{ $('set_data').item.json.cep }}","uf":"={{ $('set_data').item.json.uf }}","municipio":"={{ $('set_data').item.json.municipio }}","ddd1":"={{ $('set_data').item.json.ddd1 }}","telefone1":"={{ $('set_data').item.json.telefone1 }}","ddd2":"={{ $('set_data').item.json.ddd2 }}","telefone2":"={{ $('set_data').item.json.telefone2 }}","ddd_fax":"={{ $('set_data').item.json.ddd_fax }}","fax":"={{ $('set_data').item.json.fax }}","correio_eletronico":"={{ $json.contact.emails.toJsonString() }}","situacao_especial":"={{ $('set_data').item.json.situacao_especial }}","data_situacao_especial":"={{ $('set_data').item.json.data_situacao_especial }}","site":"={{ $json.contact.website_url }}","cnpj":"={{ $('set_data').item.json.cnpj_basico }}{{ $('set_data').item.json.cnpj_ordem }}{{ $('set_data').item.json.cnpj_dv }}","clientes":"={{ $json.reputation.client_list.toJsonString() }}","resumo_empresa":"={{ $json.identity.description }}","n_exibicoes":"={{ $('set_data').item.json.n_exibicoes }}","razao_social":"={{ $('set_data').item.json.razao_social }}","awards":"={{ $json.reputation.awards.toJsonString() }}","parcerias":"={{ $json.reputation.partnerships.toJsonString() }}","estudos_de_caso":"={{ $json.reputation.case_studies.toJsonString() }}","sources":"={{ $json.sources.toJsonString() }}","modelo_engajamento":"={{ $json.offerings.engagement_models.toJsonString() }}","diferenciais":"={{ $json.offerings.key_differentiators.toJsonString() }}","detalhes_de_servico":"={{ $json.offerings.service_details.toJsonString() }}","servicos":"={{ $json.offerings.services.toJsonString() }}","produtos":"={{ $json.offerings.products.toJsonString() }}","categorias_produtos":"={{ $json.offerings.product_categories.toJsonString() }}","industria":"={{ $json.classification.industry }}","modelo_de_negocio":"={{ $json.classification.business_model }}","publico_alvo":"={{ $json.classification.target_audience }}","cobertura_geografica":"={{ $json.classification.geographic_coverage }}","descricao":"={{ $json.identity.description }}","ano_fundacao":"={{ $json.identity.founding_year }}","tagline":"={{ $json.identity.tagline }}","time_tamanho":"={{ $json.team.size_range }}","time_funcoes_chave":"={{ $json.team.key_roles.toJsonString() }}","time_certificados":"={{ $json.team.team_certifications.toJsonString() }}","telefone":"={{ $json.contact.phones.toJsonString()}}","email":"={{ $json.contact.emails.toJsonString() }}","certificados":"={{ $json.reputation.certifications.toJsonString() }}","locations":"={{ $json.contact.locations.toJsonString() }}","endereco_principal":"={{ $json.contact.headquarters_address }}"},"matchingColumns":[],"schema":[{"id":"cnpj_basico","displayName":"cnpj_basico","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cnpj_ordem","displayName":"cnpj_ordem","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cnpj_dv","displayName":"cnpj_dv","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"matriz_filial","displayName":"matriz_filial","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nome_fantasia","displayName":"nome_fantasia","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"situacao_cadastral","displayName":"situacao_cadastral","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"data_situacao_cadastral","displayName":"data_situacao_cadastral","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"motivo_situacao_cadastral","displayName":"motivo_situacao_cadastral","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"nome_cidade_exterior","displayName":"nome_cidade_exterior","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"pais","displayName":"pais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"data_inicio_atividades","displayName":"data_inicio_atividades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cnae_fiscal","displayName":"cnae_fiscal","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cnae_fiscal_secundaria","displayName":"cnae_fiscal_secundaria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"tipo_logradouro","displayName":"tipo_logradouro","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"logradouro","displayName":"logradouro","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"numero","displayName":"numero","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"complemento","displayName":"complemento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"bairro","displayName":"bairro","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cep","displayName":"cep","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"uf","displayName":"uf","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"municipio","displayName":"municipio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ddd1","displayName":"ddd1","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"telefone1","displayName":"telefone1","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ddd2","displayName":"ddd2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"telefone2","displayName":"telefone2","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ddd_fax","displayName":"ddd_fax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"fax","displayName":"fax","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"correio_eletronico","displayName":"correio_eletronico","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"situacao_especial","displayName":"situacao_especial","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"data_situacao_especial","displayName":"data_situacao_especial","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cnpj","displayName":"cnpj","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"site","displayName":"site","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"clientes","displayName":"clientes","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"resumo_empresa","displayName":"resumo_empresa","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"vetorizado","displayName":"vetorizado","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"segmentos_industriais","displayName":"segmentos_industriais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"tipo_fornecedor","displayName":"tipo_fornecedor","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"especialidades","displayName":"especialidades","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"exemplo_servico","displayName":"exemplo_servico","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"categorias_materais","displayName":"categorias_materais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"telefone","displayName":"telefone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"instagram","displayName":"instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"email","displayName":"email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"n_exibicoes","displayName":"n_exibicoes","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"e-mail_extended","displayName":"e-mail_extended","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"recebe_email","displayName":"recebe_email","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"razao_social","displayName":"razao_social","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"certificados","displayName":"certificados","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"awards","displayName":"awards","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"parcerias","displayName":"parcerias","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"estudos_de_caso","displayName":"estudos_de_caso","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"sources","displayName":"sources","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"modelo_engajamento","displayName":"modelo_engajamento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"diferenciais","displayName":"diferenciais","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"detalhes_de_servico","displayName":"detalhes_de_servico","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"servicos","displayName":"servicos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"produtos","displayName":"produtos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"categorias_produtos","displayName":"categorias_produtos","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"industria","displayName":"industria","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"modelo_de_negocio","displayName":"modelo_de_negocio","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"publico_alvo","displayName":"publico_alvo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"cobertura_geografica","displayName":"cobertura_geografica","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"descricao","displayName":"descricao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ano_fundacao","displayName":"ano_fundacao","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"tagline","displayName":"tagline","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"time_tamanho","displayName":"time_tamanho","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"time_funcoes_chave","displayName":"time_funcoes_chave","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"time_certificados","displayName":"time_certificados","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"endereco_principal","displayName":"endereco_principal","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"locations","displayName":"locations","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1712,192],"id":"0c0bdb52-1097-4b00-85c4-71875c958e8f","name":"salva_empresa","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"executeQuery","query":"SELECT *\nFROM cnpj_db.estabelecimento\nWHERE \n  (\n    {{ !$json.cnpjs || $json.cnpjs.length === 0 }}\n    OR cnpj_basico <> ALL(\n        ARRAY[\n          {{ $json.cnpjs && $json.cnpjs.length > 0 ? $json.cnpjs.map(x => `'${x}'`).join(',') : '' }}\n        ]::text[]\n    )\n  )\n  AND resumo_empresa IS NOT NULL\n  AND erro_api_scrape IS NOT TRUE\nLIMIT 500;\n\n\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[0,192],"id":"c10e7539-018b-4de2-898c-62aa6ec24d65","name":"get_estabelecimentos","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"workflowId":{"__rl":true,"value":"dOly95LPKJyWAssG","mode":"list","cachedResultUrl":"/workflow/dOly95LPKJyWAssG","cachedResultName":"insere_empresa"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"mode":"each","options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.3,"position":[864,192],"id":"8965cf1c-4f12-49f4-a563-a8e5225684ba","name":"Call 'insere_empresa'"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"empresas_processadas","mode":"list","cachedResultName":"empresas_processadas"},"returnAll":true,"options":{"outputColumns":["cnpj_basico"]}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-640,192],"id":"461b94e7-65ba-4584-b37e-fb28259d5829","name":"get_empresa","alwaysOutputData":true,"credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"assignments":{"assignments":[{"id":"ea9c8ceb-e51a-4103-977d-47a123e6524e","name":"cnpj_basico","value":"={{ $json.cnpj_basico }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-432,192],"id":"a5c13a66-73e2-4dff-b0b8-11c9a6cc3fb0","name":"Edit Fields"},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"cnpj_basico","renameField":true,"outputFieldName":"cnpjs"}]},"options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-224,192],"id":"c750b313-37c3-4f96-84c6-2ef5893fb1e3","name":"Aggregate"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"9c68a889-c6ed-46d6-8f39-9e755e121047","leftValue":"={{ $json.erro_api_scrape }}","rightValue":false,"operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[208,192],"id":"b2ae5c8f-1282-4420-9a74-d7550e357808","name":"Filter"},{"parameters":{"batchSize":100,"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[688,192],"id":"e1b6db13-a77e-46d7-9d08-f98e105ed280","name":"Loop Over Items"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1072,192],"id":"d008ebb6-6cc8-4ad0-b825-82ee00bbcc3b","name":"Wait","webhookId":"a85054ff-1fc4-4836-930e-6a52d871d817"},{"parameters":{"maxItems":500},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[336,96],"id":"253348a8-21a6-4d66-8709-b78d27443e3f","name":"Limit"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"get_empresa","type":"main","index":0}]]},"get_empresas":{"main":[[{"node":"Scraper_api","type":"main","index":0}]]},"set_data":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Scraper_api":{"main":[[{"node":"salva_empresa","type":"main","index":0}]]},"get_estabelecimentos":{"main":[[{"node":"Filter","type":"main","index":0}]]},"get_empresa":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"get_estabelecimentos","type":"main","index":0}]]},"Filter":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Call 'insere_empresa'","type":"main","index":0}]]},"Call 'insere_empresa'":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Limit":{"main":[[{"node":"set_data","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a08888a6-5013-4c04-9cd8-1adc94e36a50","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-03T16:10:39.770Z","createdAt":"2025-12-03T16:10:39.770Z","role":"workflow:owner","workflowId":"1Gpc88PgeKGsYRmh","projectId":"jk0yZKautC5L7CBp"}],"activeVersion":null,"tags":[]}