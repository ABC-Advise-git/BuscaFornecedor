{"updatedAt":"2026-01-14T14:10:10.474Z","createdAt":"2026-01-07T19:32:52.233Z","id":"WmhV0GzExyOfmgPK6I7_d","name":"Processa Scrape Fornecedores","active":false,"isArchived":false,"nodes":[{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"81f5e058-bec9-4905-9503-92c86f83630c","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1200,-896],"id":"35ea7bac-6e7a-4867-bbef-1e14059c5ed9","name":"RAM Ok?"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1200,-560],"id":"73b048d4-2144-459c-a49e-6bb3378ef8fc","name":"Wait","webhookId":"06f32e1c-2aea-4f43-945f-863428e476e6"},{"parameters":{"workflowInputs":{"values":[{"name":"prompt"},{"name":"URL_VLLM"},{"name":"URL_METRICS"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1104,-304],"id":"96463e4f-8af5-499d-a24e-e0be6792d737","name":"When Executed by Another Workflow"},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"mode":"list","value":""}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1200,-736],"id":"8e043812-b8da-424e-83e4-f8d340484bb2","name":"Save on BD","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1456,-720],"id":"430df8c4-5470-4949-9937-b3ad1486105e","name":"When clicking ‘Execute workflow’"},{"parameters":{"jsCode":"let metricsText;\n\n// Normalização robusta da resposta do HTTP Request\nconst input = $input.first().json;\n\nif (typeof input === \"string\") {\n  metricsText = input;\n} else if (typeof input.body === \"string\") {\n  metricsText = input.body;\n} else if (typeof input.data === \"string\") {\n  metricsText = input.data;\n} else {\n  throw new Error(\n    \"Resposta do /metrics não é string. Verifique o HTTP Request Node.\"\n  );\n}\n\n// Métricas alvo\nconst TARGET_METRICS = {\n  \"vllm:num_requests_running\": null,\n  \"vllm:num_requests_waiting\": null,\n  \"vllm:kv_cache_usage_perc\": null,\n  \"vllm:request_queue_time_seconds_sum\": null,\n  \"vllm:request_queue_time_seconds_count\": null,\n};\n\n// Regex Prometheus\nconst metricRegex =\n  /^([a-zA-Z_:][a-zA-Z0-9_:]*)(?:\\{[^}]*\\})?\\s+([0-9.eE+-]+)$/;\n\nfor (const line of metricsText.split(\"\\n\")) {\n  const match = line.match(metricRegex);\n  if (!match) continue;\n\n  const name = match[1];\n  const value = Number(match[2]);\n\n  if (name in TARGET_METRICS) {\n    TARGET_METRICS[name] = value;\n  }\n}\n\n// Métrica derivada\nlet avgQueueTime = null;\nif (\n  TARGET_METRICS[\"vllm:request_queue_time_seconds_sum\"] !== null &&\n  TARGET_METRICS[\"vllm:request_queue_time_seconds_count\"] > 0\n) {\n  avgQueueTime =\n    TARGET_METRICS[\"vllm:request_queue_time_seconds_sum\"] /\n    TARGET_METRICS[\"vllm:request_queue_time_seconds_count\"];\n}\n\nreturn [\n  {\n    json: {\n      num_requests_running: TARGET_METRICS[\"vllm:num_requests_running\"],\n      num_requests_waiting: TARGET_METRICS[\"vllm:num_requests_waiting\"],\n      kv_cache_usage_perc: TARGET_METRICS[\"vllm:kv_cache_usage_perc\"],\n      avg_queue_time_seconds: avgQueueTime,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-272,-416],"id":"2f9a4419-9bd9-4a86-a56d-12bea4ad64cf","name":"Code in JavaScript"},{"parameters":{"url":"={{ $json.URL_VLLM }}/metrics","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-480,-416],"id":"0d96dc66-8751-4150-b429-aff19c3488b6","name":"LLM-Metrics"},{"parameters":{"url":"={{ $json.URL_METRICS }}/metrics ","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-400,-176],"id":"86f6f018-143e-4342-8652-e94ab838752b","name":"Sidecar-metrics"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[48,-304],"id":"f41c21b0-c91a-4dc5-8cce-6cca5c807a21","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"29b20cf2-da25-4747-9959-cbb2c71b022e","name":"num_requests_running","value":"={{ $json.num_requests_running }}","type":"number"},{"id":"93608a69-fb93-4beb-9623-fc7c250bd853","name":"num_requests_waiting","value":"={{ $json.num_requests_waiting }}","type":"number"},{"id":"83479628-df5e-4ce4-b9a3-201c9d2af176","name":"kv_cache_usage_perc","value":"={{ $json.kv_cache_usage_perc }}","type":"number"},{"id":"0be491e6-24ee-4531-bef5-1e74cb674166","name":"avg_queue_time_seconds","value":"={{ $json.avg_queue_time_seconds }}","type":"number"},{"id":"c334e765-993d-4589-a4b3-2b060b5e6bfa","name":"gpu_util_percent","value":"={{ $json.gpu.devices[0].gpu_util_percent }}","type":"string"},{"id":"a8d099c9-44b0-49f8-9eff-404906011e8e","name":"total_gb","value":"={{ $json.memory.total_gb }}","type":"string"},{"id":"a2c16eff-c23d-42e2-992e-8088608ea6a1","name":"used_gb","value":"={{ $json.memory.used_gb }}","type":"string"},{"id":"de848f10-cdef-4f14-a7e3-c92d04282af2","name":"percent_memory","value":"={{ $json.memory.percent }}","type":"string"},{"id":"1c5bcf1b-a86f-4a6a-888e-051f52fc5e7b","name":"cpu_percent","value":"={{ $json.cpu.percent }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[256,-304],"id":"b3c1c5ee-8002-4af3-8549-6eba5297ad24","name":"set-metrics"},{"parameters":{"method":"POST","url":"https://vm-phoenix-tracer-buscafornecedor.up.railway.app/v1/chat/completions","sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Edit Fields').item.json.prompt }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1696,-432],"id":"521d9a3e-3a40-447f-8a5d-7518aac7d447","name":"Phoenix","onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"113e9206-8ddb-49db-a5f1-4a19a0029198","name":"prompt","value":"={{ $json.prompt }}","type":"object"},{"id":"6a9c2963-9990-48d0-9f89-a1b8e306f58c","name":"URL_VLLM","value":"={{ $json.URL_VLLM }}","type":"string"},{"id":"42305ea2-5f96-4850-997e-ef8bccb89edc","name":"URL_METRICS","value":"={{ $json.URL_METRICS }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-784,-304],"id":"e39b3d60-85b4-43c1-beea-1c3246e91788","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"8c46a15e-aac6-4493-b396-5be3baef9ad1","name":"prompt","value":"={{ $('Edit Fields').item.json.prompt }}","type":"object"},{"id":"d1b204a8-0e8a-450c-857f-acb17de017be","name":"URL_VLLM","value":"={{ $('When Executed by Another Workflow').item.json.URL_VLLM }}","type":"string"},{"id":"9486c9d0-06a4-4319-bba7-1c574f49fc99","name":"URL_METRICS","value":"={{ $('When Executed by Another Workflow').item.json.URL_METRICS }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1904,80],"id":"2901ac5a-9fbf-41e6-968b-06ce6440f7d9","name":"Edit Fields1"},{"parameters":{"jsCode":"let metricsText;\n\n// Normalização robusta da resposta do HTTP Request\nconst input = $input.first().json;\n\nif (typeof input === \"string\") {\n  metricsText = input;\n} else if (typeof input.body === \"string\") {\n  metricsText = input.body;\n} else if (typeof input.data === \"string\") {\n  metricsText = input.data;\n} else {\n  throw new Error(\n    \"Resposta do /metrics não é string. Verifique o HTTP Request Node.\"\n  );\n}\n\n// Métricas alvo\nconst TARGET_METRICS = {\n  \"vllm:num_requests_running\": null,\n  \"vllm:num_requests_waiting\": null,\n  \"vllm:kv_cache_usage_perc\": null,\n  \"vllm:request_queue_time_seconds_sum\": null,\n  \"vllm:request_queue_time_seconds_count\": null,\n};\n\n// Regex Prometheus\nconst metricRegex =\n  /^([a-zA-Z_:][a-zA-Z0-9_:]*)(?:\\{[^}]*\\})?\\s+([0-9.eE+-]+)$/;\n\nfor (const line of metricsText.split(\"\\n\")) {\n  const match = line.match(metricRegex);\n  if (!match) continue;\n\n  const name = match[1];\n  const value = Number(match[2]);\n\n  if (name in TARGET_METRICS) {\n    TARGET_METRICS[name] = value;\n  }\n}\n\n// Métrica derivada\nlet avgQueueTime = null;\nif (\n  TARGET_METRICS[\"vllm:request_queue_time_seconds_sum\"] !== null &&\n  TARGET_METRICS[\"vllm:request_queue_time_seconds_count\"] > 0\n) {\n  avgQueueTime =\n    TARGET_METRICS[\"vllm:request_queue_time_seconds_sum\"] /\n    TARGET_METRICS[\"vllm:request_queue_time_seconds_count\"];\n}\n\nreturn [\n  {\n    json: {\n      num_requests_running: TARGET_METRICS[\"vllm:num_requests_running\"],\n      num_requests_waiting: TARGET_METRICS[\"vllm:num_requests_waiting\"],\n      kv_cache_usage_perc: TARGET_METRICS[\"vllm:kv_cache_usage_perc\"],\n      avg_queue_time_seconds: avgQueueTime,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2016,928],"id":"c2cef823-8b24-4704-8dd2-579271af4a77","name":"Code in JavaScript1"},{"parameters":{"url":"https://5u888x525vvzvs-8000.proxy.runpod.net/metrics","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-2224,928],"id":"29258053-29e9-4cdc-a6f0-cbee7b307710","name":"LLM-Metrics1"},{"parameters":{"url":"https://5u888x525vvzvs-9100.proxy.runpod.net/metrics","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-2144,1168],"id":"6af8aeeb-da70-4b3c-8459-009167d7cf13","name":"Sidecar-metrics1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-1696,1040],"id":"0727d6fa-aea9-4d7a-a8f2-e99620452172","name":"Merge1"},{"parameters":{"assignments":{"assignments":[{"id":"29b20cf2-da25-4747-9959-cbb2c71b022e","name":"num_requests_running","value":"={{ $json.num_requests_running }}","type":"number"},{"id":"93608a69-fb93-4beb-9623-fc7c250bd853","name":"num_requests_waiting","value":"={{ $json.num_requests_waiting }}","type":"number"},{"id":"83479628-df5e-4ce4-b9a3-201c9d2af176","name":"kv_cache_usage_perc","value":"={{ $json.kv_cache_usage_perc }}","type":"number"},{"id":"0be491e6-24ee-4531-bef5-1e74cb674166","name":"avg_queue_time_seconds","value":"={{ $json.avg_queue_time_seconds }}","type":"number"},{"id":"c334e765-993d-4589-a4b3-2b060b5e6bfa","name":"gpu_util_percent","value":"={{ $json.gpu.devices[0].gpu_util_percent }}","type":"string"},{"id":"a8d099c9-44b0-49f8-9eff-404906011e8e","name":"total_gb","value":"={{ $json.memory.total_gb }}","type":"string"},{"id":"a2c16eff-c23d-42e2-992e-8088608ea6a1","name":"used_gb","value":"={{ $json.memory.used_gb }}","type":"string"},{"id":"de848f10-cdef-4f14-a7e3-c92d04282af2","name":"percent_memory","value":"={{ $json.memory.percent }}","type":"string"},{"id":"1c5bcf1b-a86f-4a6a-888e-051f52fc5e7b","name":"cpu_percent","value":"={{ $json.cpu.percent }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1488,1040],"id":"ceb7625a-06b8-47b9-9956-1066fbccaa3a","name":"set-metrics1"},{"parameters":{"method":"POST","url":"https://vm-phoenix-tracer-buscafornecedor.up.railway.app/v1/chat/completions","sendBody":true,"specifyBody":"json","jsonBody":"={{ $('Edit Fields2').item.json.prompt }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-288,1040],"id":"c6e7b1f7-e6ba-4462-8e08-ac5ba3347095","name":"Phoenix1"},{"parameters":{"assignments":{"assignments":[{"id":"113e9206-8ddb-49db-a5f1-4a19a0029198","name":"prompt","value":"={{ $json.prompt }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2528,1008],"id":"c4d5cd19-0d0d-44f2-ab77-1e04c7985ead","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"8c46a15e-aac6-4493-b396-5be3baef9ad1","name":"prompt","value":"={{ $('Edit Fields2').item.json.prompt }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-80,1376],"id":"362fe864-2269-40f7-91eb-706127bb955e","name":"Edit Fields3"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-928,1056],"id":"262f06f7-5849-41f9-af61-040f1a64d7c9","name":"Checa fila"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1184,1040],"id":"6c4e04a1-7a91-4711-a9cc-72f07802a5d4","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-720,1136],"id":"ee3531c2-98e4-41cb-aaa4-54c5b952ad4a","name":"olha cache disponivel"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-720,880],"id":"99ec342b-c236-4f47-9e55-789ba00160a6","name":"estima token e volume de gb da requisicao com margem de seguranca"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-496,1008],"id":"21d48a83-e0f7-4899-a050-0a21cb777052","name":"se a estimativa de consumo da nova request cabe no cache processa, senao espera ter espaco"},{"parameters":{"schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"LLM-Metrics","mode":"list","cachedResultName":"LLM-Metrics"},"columns":{"mappingMode":"defineBelow","value":{"num_requests_running":"={{ $json.num_requests_running }}","num_requests_waiting":"={{ $json.num_requests_waiting }}","kv_cache_usage_perc":"={{ $json.kv_cache_usage_perc }}","avg_queue_time_seconds":"={{ $json.avg_queue_time_seconds }}","gpu_util_percent":"={{ $json.gpu_util_percent.toNumber() }}","total_gb":"={{ $json.total_gb.toNumber() }}","used_gb":"={{ $json.used_gb.toNumber() }}","percent_memory":"={{ $json.percent_memory.toNumber() }}","cpu_percent":"={{ $json.cpu_percent.toNumber() }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"num_requests_running","displayName":"num_requests_running","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"num_requests_waiting","displayName":"num_requests_waiting","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"kv_cache_usage_perc","displayName":"kv_cache_usage_perc","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"avg_queue_time_seconds","displayName":"avg_queue_time_seconds","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"gpu_util_percent","displayName":"gpu_util_percent","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"total_gb","displayName":"total_gb","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"used_gb","displayName":"used_gb","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"percent_memory","displayName":"percent_memory","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"cpu_percent","displayName":"cpu_percent","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[464,-304],"id":"1d6cde64-340f-4048-a904-c18324c12ba3","name":"Insert rows in a table","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1584,-80],"id":"5dc8d60a-5012-4878-b4b9-72a90ff0fa17","name":"Wait-2","webhookId":"e8b0371b-b0de-493d-babd-790e725218fa"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1328,48],"id":"32cf98e3-cdf2-41a6-87f8-8a14d65d3865","name":"Wait-5","webhookId":"e8b0371b-b0de-493d-babd-790e725218fa"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.num_requests_running.toNumber() }}","rightValue":5,"operator":{"type":"number","operation":"lte"},"id":"25b6ee73-5146-44a3-a3d4-309b3478f85e"}],"combinator":"and"},"renameOutput":true,"outputKey":"seguir"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"fca942f5-cb42-477d-9ac7-702424382e4e","leftValue":"={{ $json.num_requests_running.toNumber() }}","rightValue":10,"operator":{"type":"number","operation":"lte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"cb351521-7114-468f-8b7e-e6dfd082b1ce","leftValue":"={{ $json.num_requests_running.toNumber() }}","rightValue":11,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar-mais"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[672,-320],"id":"91f35353-709e-4bee-981c-6821e4782414","name":"request_running"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.num_requests_waiting.toNumber() }}","rightValue":0,"operator":{"type":"number","operation":"equals"},"id":"25b6ee73-5146-44a3-a3d4-309b3478f85e"}],"combinator":"and"},"renameOutput":true,"outputKey":"seguir"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"fca942f5-cb42-477d-9ac7-702424382e4e","leftValue":"={{ $json.num_requests_waiting.toNumber() }}","rightValue":5,"operator":{"type":"number","operation":"lte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"cb351521-7114-468f-8b7e-e6dfd082b1ce","leftValue":"={{ $json.num_requests_waiting.toNumber() }}","rightValue":6,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar-mais"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[912,-352],"id":"f0e6c5cf-5151-4cc8-96c6-7e3409dbe8e9","name":"request_waiting"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.kv_cache_usage_perc }}","rightValue":60,"operator":{"type":"number","operation":"lte"},"id":"25b6ee73-5146-44a3-a3d4-309b3478f85e"}],"combinator":"and"},"renameOutput":true,"outputKey":"seguir"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"fca942f5-cb42-477d-9ac7-702424382e4e","leftValue":"={{ $json.kv_cache_usage_perc }}","rightValue":80,"operator":{"type":"number","operation":"lte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"cb351521-7114-468f-8b7e-e6dfd082b1ce","leftValue":"={{ $json.kv_cache_usage_perc }}","rightValue":80,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar-mais"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[1152,-384],"id":"f26bebd6-6f55-4ed1-9ca2-383c19d8f80e","name":"kv_cache"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $json.cpu_percent }}","rightValue":70,"operator":{"type":"number","operation":"lte"},"id":"25b6ee73-5146-44a3-a3d4-309b3478f85e"}],"combinator":"and"},"renameOutput":true,"outputKey":"seguir"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"fca942f5-cb42-477d-9ac7-702424382e4e","leftValue":"={{ $json.cpu_percent }}","rightValue":95,"operator":{"type":"number","operation":"lte"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"cb351521-7114-468f-8b7e-e6dfd082b1ce","leftValue":"={{ $json.cpu_percent }}","rightValue":95,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"renameOutput":true,"outputKey":"esperar-mais"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[1392,-416],"id":"31083272-b878-45d7-90f5-31782c2ef697","name":"cpu_percent"},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"LLM-Metrics","mode":"list","cachedResultName":"LLM-Metrics"},"columns":{"mappingMode":"defineBelow","value":{"error":true,"id":"={{ $('Insert rows in a table').item.json.id }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"num_requests_running","displayName":"num_requests_running","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"num_requests_waiting","displayName":"num_requests_waiting","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"kv_cache_usage_perc","displayName":"kv_cache_usage_perc","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"avg_queue_time_seconds","displayName":"avg_queue_time_seconds","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"gpu_util_percent","displayName":"gpu_util_percent","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"total_gb","displayName":"total_gb","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"used_gb","displayName":"used_gb","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"percent_memory","displayName":"percent_memory","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"cpu_percent","displayName":"cpu_percent","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"error","displayName":"error","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true},{"id":"error_message","displayName":"error_message","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2016,-416],"id":"aa9e1de0-264c-4842-ae73-24cd551b3356","name":"Insert error","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}}],"connections":{"RAM Ok?":{"main":[[],[]]},"Wait":{"main":[[]]},"When Executed by Another Workflow":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[]]},"LLM-Metrics":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Sidecar-metrics":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Code in JavaScript":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"set-metrics","type":"main","index":0}]]},"set-metrics":{"main":[[{"node":"Insert rows in a table","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"LLM-Metrics","type":"main","index":0},{"node":"Sidecar-metrics","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"LLM-Metrics1":{"main":[[{"node":"Code in JavaScript1","type":"main","index":0}]]},"Sidecar-metrics1":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge1":{"main":[[{"node":"set-metrics1","type":"main","index":0}]]},"set-metrics1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"LLM-Metrics1","type":"main","index":0},{"node":"Sidecar-metrics1","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Checa fila","type":"main","index":0}]]},"Checa fila":{"main":[[{"node":"olha cache disponivel","type":"main","index":0},{"node":"estima token e volume de gb da requisicao com margem de seguranca","type":"main","index":0}]]},"olha cache disponivel":{"main":[[{"node":"se a estimativa de consumo da nova request cabe no cache processa, senao espera ter espaco","type":"main","index":0}]]},"estima token e volume de gb da requisicao com margem de seguranca":{"main":[[{"node":"se a estimativa de consumo da nova request cabe no cache processa, senao espera ter espaco","type":"main","index":0}]]},"Insert rows in a table":{"main":[[{"node":"request_running","type":"main","index":0}]]},"Wait-2":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Wait-5":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"request_running":{"main":[[{"node":"request_waiting","type":"main","index":0}],[{"node":"Wait-2","type":"main","index":0}],[{"node":"Wait-5","type":"main","index":0}]]},"request_waiting":{"main":[[{"node":"kv_cache","type":"main","index":0}],[{"node":"Wait-2","type":"main","index":0}],[{"node":"Wait-5","type":"main","index":0}]]},"kv_cache":{"main":[[{"node":"cpu_percent","type":"main","index":0}],[{"node":"Wait-2","type":"main","index":0}],[{"node":"Wait-5","type":"main","index":0}]]},"cpu_percent":{"main":[[{"node":"Phoenix","type":"main","index":0}],[{"node":"Wait-2","type":"main","index":0}],[{"node":"Wait-5","type":"main","index":0}]]},"Phoenix":{"main":[[],[{"node":"Insert error","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"prompt":{"model":"mistralai/Ministral-3-3B-Instruct-2512","messages":[{"role":"user","content":"Tarefa:\nVocê receberá um texto extenso e não estruturado contendo informações explícitas e implícitas sobre uma empresa. A partir exclusivamente desse texto, reconstrua o perfil completo da empresa.\n\nExtraia e organize as informações sempre que possível nos seguintes eixos:\n- Nome ou identificação da empresa\n- Indústria principal\n- Modelo de negócio\n- Produtos e/ou serviços oferecidos\n- Público-alvo\n- Cobertura geográfica\n- Nível de uso de tecnologia\n\nRegras:\n- Baseie-se apenas nas informações inferidas do texto fornecido\n- Não faça suposições externas\n- Se alguma informação não estiver clara, indique como \"não identificado\"\n- Seja objetivo, técnico e estruturado\n\nFormato obrigatório da resposta (não altere):\nNOME_DA_EMPRESA:\nINDUSTRIA:\nMODELO_DE_NEGOCIO:\nPRODUTOS_SERVICOS:\nPUBLICO_ALVO:\nCOBERTURA_GEOGRAFICA:\nUSO_DE_TECNOLOGIA: 500 tokens"},{"role":"user","content":"BLOCO 1 — CONTEXTO INSTITUCIONAL E IDENTIDADE  A empresa conhecida comercialmente como CAIS DO PAPEL opera há anos em um segmento tradicional do mercado brasileiro, com forte presença no varejo físico e atuação consolidada no fornecimento de produtos voltados ao consumo corporativo e doméstico. Seu posicionamento não nasce como uma empresa de tecnologia, mas como uma organização orientada à distribuição e comercialização de itens essenciais para escritórios, instituições de ensino, profissionais autônomos e consumidores finais. Ao longo do tempo, a empresa estruturou sua identidade em torno da confiabilidade logística, variedade de portfólio e atendimento regional especializado, mantendo uma operação alinhada às demandas locais do município de São João da Boa Vista, no interior do estado de São Paulo.  A identidade da empresa se constrói a partir da diversidade de produtos comercializados, abrangendo desde materiais escolares básicos até suprimentos mais específicos utilizados em ambientes corporativos e residenciais. Embora o nome “CAIS DO PAPEL” remeta diretamente ao segmento de papelaria, sua atuação extrapola esse escopo restrito, incorporando itens de informática, acessórios, utilidades domésticas e produtos complementares que ampliam o ticket médio e o alcance de mercado. A empresa não se posiciona como desenvolvedora de soluções digitais, tampouco como provedora de software, mas sim como uma operação de varejo estruturada em catálogo amplo e presença física.  BLOCO 2 — PORTFÓLIO DE PRODUTOS E CATEGORIAS  O portfólio da empresa é organizado em múltiplas categorias de produtos, refletindo uma estratégia de abrangência e capilaridade comercial. Entre as categorias mais relevantes encontram-se materiais escolares, amplamente utilizados por estudantes, professores e instituições de ensino, além de materiais de escritório voltados ao uso corporativo cotidiano. Esses itens incluem papéis, pastas, organizadores, instrumentos de escrita e acessórios administrativos que sustentam o funcionamento básico de empresas de diferentes portes.  Além disso, a empresa comercializa materiais voltados à engenharia e áreas técnicas, bem como produtos associados ao artesanato e atividades manuais, ampliando sua base de clientes para além do público corporativo tradicional. O catálogo também contempla suprimentos de informática, acessórios para games, bolsas para notebooks, telefones, calculadoras e carregadores, indicando uma estratégia de cross-selling voltada à conveniência do consumidor. Esse conjunto de categorias evidencia uma operação focada em varejo diversificado, com baixa especialização vertical, mas alto volume de SKUs, característica típica de papelarias de médio porte com atuação regional.  BLOCO 3 — MODELO DE NEGÓCIO E OPERAÇÃO  Do ponto de vista de modelo de negócio, a CAIS DO PAPEL opera predominantemente no varejo, com foco na venda direta de produtos físicos. Sua estrutura não envolve assinatura recorrente, licenciamento de tecnologia ou prestação de serviços digitais escaláveis, mas sim a comercialização unitária de itens tangíveis. A receita é gerada a partir do giro de estoque e da margem sobre produtos, exigindo gestão logística eficiente, controle de inventário e relacionamento próximo com fornecedores.  A maturidade da operação está associada à capacidade de manter variedade de produtos, atender demandas locais com rapidez e sustentar relacionamento com clientes recorrentes, especialmente empresas e instituições que demandam reposição constante de materiais. Não há indícios de automação avançada baseada em software proprietário, nem de desenvolvimento de plataformas SaaS ou soluções B2B digitais. O foco operacional permanece ancorado em processos comerciais tradicionais, com eventual apoio de sistemas de gestão internos, típicos de empresas varejistas.  BLOCO 4 — CONTEXTO DE MERCADO E POSICIONAMENTO  Inserida no setor de papelaria e suprimentos, a empresa atua em um mercado altamente competitivo e fragmentado, onde diferenciação ocorre principalmente por preço, conveniência, localização e variedade de produtos. Diferentemente de empresas SaaS B2B, que escalam por meio de tecnologia e automação, o crescimento da CAIS DO PAPEL está diretamente relacionado à expansão física, aumento de mix de produtos e fidelização de clientes regionais.  Seu posicionamento não está associado a soluções de automação de processos empresariais, analytics, onboarding digital ou gestão de pessoas, mas sim ao fornecimento de insumos necessários para o funcionamento de escritórios, escolas e residências. Ainda que atenda empresas, seu papel é de fornecedor de bens de consumo e não de parceiro estratégico em transformação digital ou otimização de processos organizacionais.  BLOCO 5 — COBERTURA GEOGRÁFICA E CONTEXTO OPERACIONAL  A atuação geográfica da empresa é predominantemente local, concentrada em São João da Boa Vista – SP, o que reforça seu caráter regional e sua proximidade com a base de clientes. Essa cobertura limitada favorece relações comerciais diretas, conhecimento aprofundado do mercado local e atendimento personalizado, mas também restringe a escalabilidade típica de modelos digitais ou SaaS, que operam em âmbito nacional ou internacional com baixo custo marginal.  A empresa não apresenta características de operação remota, multitenant ou orientada a plataformas digitais. Seu valor está na disponibilidade imediata de produtos físicos e na conveniência para clientes locais, em contraste com empresas de tecnologia que entregam valor por meio de software, automação e dados. Esse contexto operacional consolida a CAIS DO PAPEL como uma empresa de varejo tradicional, com forte ancoragem territorial e foco em produtos físicos."}],"temperature":0.1,"max_tokens":500,"stream":false},"URL_VLLM":"https://5u888x525vvzvs-8000.proxy.runpod.net","URL_METRICS":"https://5u888x525vvzvs-9100.proxy.runpod.net"},"pairedItem":{"item":0}}]},"versionId":"1b343995-ca54-4841-b82a-a0469b211010","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-07T19:32:52.233Z","createdAt":"2026-01-07T19:32:52.233Z","role":"workflow:owner","workflowId":"WmhV0GzExyOfmgPK6I7_d","projectId":"jk0yZKautC5L7CBp"}],"activeVersion":null,"tags":[]}