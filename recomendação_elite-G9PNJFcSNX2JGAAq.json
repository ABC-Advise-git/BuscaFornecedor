{"updatedAt":"2025-11-27T22:13:03.802Z","createdAt":"2025-11-18T13:52:20.080Z","id":"G9PNJFcSNX2JGAAq","name":"Recomendação_elite","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"assinatura-elite","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-656,16],"id":"bcdd4617-8cc5-4eb0-8ce9-a0662634a1e1","name":"Webhook","webhookId":"9f06d9b9-36d2-47da-af99-bd37f48debec"},{"parameters":{"content":"## Resumir a empresa e os tipos de serviço/produto que ela oferece.\n\n- Esse resumo deve ser feito no smesmos molder do resumo feito dos perfis de compradores para que a query no bd seja mais eficiente.","height":432,"width":320,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,-240],"id":"3ed6cb2a-0141-4967-9384-ae4dd9abbe22","name":"Sticky Note"},{"parameters":{"content":"## Realiza uma busca semantica no banco vetorial\n\n- Busca perfis de compradores que tenham aderencia com os oferecimentos da empresa.\n- Limite = 10\n","height":432,"width":320,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[512,-240],"id":"2c099071-8d56-4eb4-abac-3e0c272b50d0","name":"Sticky Note1"},{"parameters":{"content":"## Envia um e-mail aos n compradores mais aderentes.\n","height":320,"width":256,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1424,-128],"id":"ffb93722-deda-489c-9722-1c37f8ca831c","name":"Sticky Note2"},{"parameters":{"content":"## Busca o email daquele comprador\n","height":256,"width":560,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[848,-64],"id":"efb48b30-e9ec-421c-ac95-2c84469ccd6f","name":"Sticky Note3"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[224,256],"id":"7f9292d3-7a49-430d-a144-4264ad29963f","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[560,256],"id":"c1b4952f-1e62-4210-9fee-ba5305cfeec4","name":"Embeddings Google Gemini1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"=data_empresa = {{ $json.empresa.toJsonString() }}","options":{"systemMessage":"=## Ferramentas Disponíveis\nVocê pode consultar o banco_cnaes para recuperar informações técnicas sobre CNAEs sempre que isso contribuir para entender melhor o perfil da empresa.\n\n---\n\n## Papel\nVocê é um agente especialista em interpretar dados empresariais mínimos — como CNAEs, natureza da operação e informações opcionais — e gerar um **resumo padronizado, conciso e vetorial** que represente o perfil real de atuação da empresa.\n\nSeu papel é sintetizar **o que essa empresa faz**, **como opera** e **qual o foco percebido**, mesmo quando os dados fornecidos são curtos ou limitados.\n\n---\n\n## Objetivo\nGerar um resumo em **3 parágrafos curtos**, seguindo rigorosamente o padrão:\n1. **Atuação principal da empresa** com base em CNAE e dados relevantes.  \n2. **Foco operacional, serviços e natureza das atividades**, usando CNAEs secundários quando fizer sentido.  \n3. **Contexto de mercado e abrangência geográfica percebida**, sem inventar nada fora do que está nos dados.\n\nO texto será usado em embeddings, portanto deve ser claro, coeso, técnico e direto.\n\n---\n\n## Instruções Gerais\n- Não invente informações — só use o que for derivável dos CNAEs e dados explícitos.  \n- Não cite códigos numéricos; traduza CNAEs em texto quando necessário.  \n- Se um CNAE tiver descrição útil, você pode recuperar a informação pelo banco vetorial.  \n- Não mencione ferramentas, consultas ou estrutura de JSON.  \n- Não inclua endereço, telefone, CNPJ ou qualquer dado administrativo.  \n- Não usar listas — apenas texto contínuo.  \n- Nenhum parágrafo deve ser muito longo; mantenha o estilo conciso dos few-shots fornecidos.\n\n---\n\n## Saída\nRetorne **somente o texto final**, composto por exatamente **3 parágrafos curtos**, seguindo o mesmo estilo dos exemplos.\n\nComece diretamente com o parágrafo 1, sem título “Resumo da Empresa” ou qualquer cabeçalho.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[224,16],"id":"9a0d7a95-196d-4261-8e61-6a246eeca8bd","name":"Criar resumo de empresa"},{"parameters":{"mode":"load","tableName":"busca_fornecedor_gemini","prompt":"={{ $json.output }}","topK":10,"includeDocumentMetadata":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[560,16],"id":"c6307f1c-42b9-43a0-a7c4-b135bb16d4f7","name":"busca_comprador","credentials":{"postgres":{"id":"MHRHdP7WLUhVnoIo","name":"pgvector"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"usuario_fornecedor","mode":"list","cachedResultName":"usuario_fornecedor"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.body.fornecedor_id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-464,16],"id":"02f03139-982d-4de1-b137-1a32d6186f81","name":"get_fornecedor","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"estabelecimento","mode":"list","cachedResultName":"estabelecimento"},"returnAll":true,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"},{"column":"cnpj_ordem","value":"={{ $json.cnpj_ordem }}"},{"column":"cnpj_dv","value":"={{ $json.cnpj_dv }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-304,16],"id":"b9de269e-932b-48e4-8783-6203204d2a9f","name":"get_estabelecimento","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"assignments":{"assignments":[{"id":"4d4879fc-cb7e-4ee8-8f52-43ff65d8dd7b","name":"empresa.matriz_filial","value":"={{ $('get_estabelecimento').item.json.matriz_filial }}","type":"string"},{"id":"e9045b84-7402-489d-b137-3eac706115aa","name":"empresa.cnae_fiscal","value":"={{ $('get_estabelecimento').item.json.cnae_fiscal }}","type":"string"},{"id":"36496f9e-8e75-4e0f-971f-471449b990fa","name":"empresa.cnae_fiscal_secundaria","value":"={{ $('get_estabelecimento').item.json.cnae_fiscal_secundaria }}","type":"string"},{"id":"ef876432-e914-46c8-8585-bdefcaa5492c","name":"empresa.uf","value":"={{ $('get_estabelecimento').item.json.uf }}","type":"string"},{"id":"f5e0ab30-d521-413e-bbbc-c9f57c0aec9d","name":"empresa.municipio","value":"={{ $('get_estabelecimento').item.json.municipio }}","type":"string"},{"id":"fd6337f7-ad28-41e3-8b2b-0a686a23972d","name":"empresa.resumo_empresa","value":"={{ $('get_estabelecimento').item.json.resumo_empresa }}","type":"string"},{"id":"afdb50d5-566d-4a84-8e76-bef856403c68","name":"empresa.especialidades","value":"={{ $('get_estabelecimento').item.json.especialidades }}","type":"string"},{"id":"10d36cc9-1c1b-4870-a482-669d3b5ce2ab","name":"empresa.categorias_materais","value":"={{ $('get_estabelecimento').item.json.categorias_materais }}","type":"string"},{"id":"c45568e9-0140-41e6-b6be-f808219cf09a","name":"empresa.razao_social","value":"={{ $json.razao_social }}","type":"string"},{"id":"5355b746-15a1-4031-aa19-52a3ac210125","name":"empresa.exemplo_servico","value":"={{ $('get_estabelecimento').item.json.exemplo_servico }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,16],"id":"239885e8-ce98-4fdf-8fc9-7c29d18210fd","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"0b908832-98ce-4f11-8b1f-1f80dacb8cee","name":"raw_user_meta_data.email","value":"={{ $json.raw_user_meta_data.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1280,16],"id":"b70d096d-c12a-452d-8d7d-0c5380c127ef","name":"set_emails"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"usuario_comprador","mode":"list","cachedResultName":"usuario_comprador"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.document.metadata.id_comprador }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[880,16],"id":"39867a17-da77-45cf-b203-ebcd5c01a26d","name":"get_comprador","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"auth","mode":"list","cachedResultName":"auth"},"table":{"__rl":true,"value":"users","mode":"list","cachedResultName":"users"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1088,16],"id":"8be6a6e7-a921-4774-aedd-8ec502f7b24d","name":"get_email","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1504,16],"id":"edba1b60-bc9e-4adb-a900-cdc13bdaaa39","name":"Loop Over Items"},{"parameters":{"sendTo":"=tbfelipe067@gmail.com","subject":"=Teste","message":"=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Novo fornecedor Elite no seu segmento</title>\n\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background-color: #f9fafb;\n      font-family: \"Inter\", Arial, sans-serif;\n      color: #0f172a;\n    }\n\n    .container {\n      max-width: 600px;\n      margin: 40px auto;\n      background: #ffffff;\n      border-radius: 16px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n      overflow: hidden;\n    }\n\n    .header {\n      background: linear-gradient(90deg, #0f172a, #00c38a);\n      color: #fff;\n      text-align: center;\n      padding: 24px;\n      font-size: 22px;\n      font-weight: 600;\n    }\n\n    .content {\n      padding: 32px 24px;\n      line-height: 1.6;\n    }\n\n    .content h1 {\n      font-size: 20px;\n      color: #0f172a;\n      margin-bottom: 16px;\n      text-align: left;\n    }\n\n    .content p {\n      font-size: 15px;\n      color: #475569;\n      margin-bottom: 20px;\n    }\n\n    .info-box {\n      background: #f1f5f9;\n      padding: 16px;\n      border-radius: 10px;\n      border: 1px solid #e2e8f0;\n      margin-bottom: 28px;\n      font-size: 14px;\n    }\n\n    .footer {\n      text-align: center;\n      font-size: 13px;\n      color: #94a3b8;\n      padding: 24px;\n      border-top: 1px solid #f1f5f9;\n      background-color: #f9fafb;\n    }\n\n    .unsubscribe-btn {\n      display: inline-block;\n      margin-top: 16px;\n      background: #ffe5e5;\n      color: #b91c1c !important;\n      text-decoration: none;\n      padding: 10px 22px;\n      border-radius: 8px;\n      font-weight: 600;\n      font-size: 14px;\n      border: 1px solid #fca5a5;\n      transition: 0.2s;\n    }\n\n    .unsubscribe-btn:hover {\n      background: #fecaca;\n    }\n\n    .unsubscribe-label {\n      margin-top: 6px;\n      font-size: 11px;\n      color: #94a3b8;\n      display: block;\n    }\n\n    @media (max-width: 600px) {\n      .content { padding: 24px 16px; }\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"container\">\n\n    <div class=\"header\">\n      BuscaFornecedor\n    </div>\n\n    <div class=\"content\">\n      <h1>Um fornecedor Elite pode te interessar!</h1>\n\n      <p>Um novo fornecedor do segmento que você acompanha acaba de ativar o <strong style=\"color:#00c38a;\">Plano Elite</strong> na plataforma.</p>\n\n      <p>Agora ele possui dados completos, mais credibilidade e maior prioridade nas recomendações.</p>\n\n      <div class=\"info-box\">\n        <strong>Razão Social:</strong> {{ $json.razao_social }}<br/>\n        <strong>Site:</strong> <a href=\"{{ $json.site }}\" target=\"_blank\">{{ $json.site }}</a><br/>\n        <strong>E-mail:</strong> {{ $json.email }}<br/><br/>\n        <strong>Resumo de Atuação:</strong><br/>\n        {{ $json.resumo_atuacao }}\n      </div>\n\n      <p>Continue acompanhando novos fornecedores e aproveite oportunidades de negócio qualificadas.</p>\n    </div>\n\n    <div class=\"footer\">\n      © 2025 BuscaFornecedor — Todos os direitos reservados.<br/>\n      <a href=\"https://buscafornecedor.com.br\" style=\"color:#00c38a; text-decoration:none;\">buscafornecedor.com.br</a><br/><br/>\n\n      <a\n        href=\"https://primary-kpc3-buscafornecedor.up.railway.app/webhook/unsubscribe?basico=[Execute previous nodes for preview]&ordem=[Execute previous nodes for preview]&dv=[Execute previous nodes for preview]\"\n        class=\"unsubscribe-btn\"\n      >\n        Não quero mais receber estes e-mails\n      </a>\n\n      <span class=\"unsubscribe-label\">Unsubscribe</span>\n    </div>\n  </div>\n</body>\n</html>\n","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1904,96],"id":"170ddc2d-507b-4f95-8241-988d24a452d5","name":"email_recomendação","webhookId":"ddcfa1ef-90d1-4866-97e4-a61d894917da","credentials":{"gmailOAuth2":{"id":"JKcZrpzTg58STyhI","name":"cred: contato@contato-buscafornecedor.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"9001f46e-7ffc-4a12-9ae7-f9557f1db677","name":"site","value":"={{ $('get_estabelecimento').item.json.site }}","type":"string"},{"id":"33fbff95-9173-4c10-9809-8fd73dc4b739","name":"email","value":"={{ $('get_estabelecimento').item.json.correio_eletronico }}","type":"string"},{"id":"a57257d5-9257-4268-a9da-cc66297d5334","name":"resumo_atuacao","value":"={{ $('Criar resumo de empresa').item.json.output }}","type":"string"},{"id":"aa9c90e9-0bd8-486c-bc3c-a294ea4a7ba8","name":"razao_social","value":"={{ $('get_estabelecimento1').item.json.razao_social }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1712,96],"id":"fba3d6a5-756a-414d-960c-381948603c63","name":"fornecedor_info"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"empresas","mode":"list","cachedResultName":"empresas"},"returnAll":true,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-128,16],"id":"c4839999-0a59-4489-9418-1931b81af3dd","name":"get_estabelecimento1","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}}],"connections":{"Webhook":{"main":[[{"node":"get_fornecedor","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Criar resumo de empresa","type":"ai_languageModel","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"busca_comprador","type":"ai_embedding","index":0}]]},"Criar resumo de empresa":{"main":[[{"node":"busca_comprador","type":"main","index":0}]]},"get_fornecedor":{"main":[[{"node":"get_estabelecimento","type":"main","index":0}]]},"get_estabelecimento":{"main":[[{"node":"get_estabelecimento1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Criar resumo de empresa","type":"main","index":0}]]},"busca_comprador":{"main":[[{"node":"get_comprador","type":"main","index":0}]]},"get_comprador":{"main":[[{"node":"get_email","type":"main","index":0}]]},"get_email":{"main":[[{"node":"set_emails","type":"main","index":0}]]},"set_emails":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"fornecedor_info","type":"main","index":0}]]},"get_estabelecimento1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"fornecedor_info":{"main":[[{"node":"email_recomendação","type":"main","index":0}]]},"email_recomendação":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"primary-kpc3-buscafornecedor.up.railway.app","user-agent":"Deno/2.1.4 (variant; SupabaseEdgeRuntime/1.69.22)","content-length":"351","accept":"application/json","accept-encoding":"gzip,br","accept-language":"*","content-type":"application/json","x-forwarded-for":"3.76.204.69","x-forwarded-host":"primary-kpc3-buscafornecedor.up.railway.app","x-forwarded-proto":"https","x-railway-edge":"railway/europe-west4-drams3a","x-railway-request-id":"Y0tJKZzxQ5mQGgdFss7a6g","x-real-ip":"3.76.204.69","x-request-start":"1763740622719"},"params":{},"query":{},"body":{"fornecedor_id":"6b543c9c-d3a7-4e18-9742-8a9d4a62d7fa","cnpj":"55691851000110","nome":null,"telefone":"666666666","email":"CORTINASZYMAR@HOTMAIL.COM","nome_fantasia":null,"site":"https://cortinaszymar.com.br/","endereco":"BARNABE DA SILVA ALMEIDA 147  PITANGUEIRAS","municipio":"6475","uf":"SP","plano":"elite","timestamp":"2025-11-21T15:57:02.654Z"},"webhookUrl":"https://primary-kpc3-buscafornecedor.up.railway.app/webhook/assinatura-elite","executionMode":"production"}}]},"versionId":"a9997fd9-9e6f-49cd-90bf-61add675f432","activeVersionId":"a9997fd9-9e6f-49cd-90bf-61add675f432","triggerCount":1,"shared":[{"updatedAt":"2025-11-18T13:52:20.080Z","createdAt":"2025-11-18T13:52:20.080Z","role":"workflow:owner","workflowId":"G9PNJFcSNX2JGAAq","projectId":"jk0yZKautC5L7CBp"}],"activeVersion":{"updatedAt":"2025-11-27T22:13:03.832Z","createdAt":"2025-11-27T22:13:03.832Z","versionId":"a9997fd9-9e6f-49cd-90bf-61add675f432","workflowId":"G9PNJFcSNX2JGAAq","nodes":[{"parameters":{"httpMethod":"POST","path":"assinatura-elite","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-656,16],"id":"bcdd4617-8cc5-4eb0-8ce9-a0662634a1e1","name":"Webhook","webhookId":"9f06d9b9-36d2-47da-af99-bd37f48debec"},{"parameters":{"content":"## Resumir a empresa e os tipos de serviço/produto que ela oferece.\n\n- Esse resumo deve ser feito no smesmos molder do resumo feito dos perfis de compradores para que a query no bd seja mais eficiente.","height":432,"width":320,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[176,-240],"id":"3ed6cb2a-0141-4967-9384-ae4dd9abbe22","name":"Sticky Note"},{"parameters":{"content":"## Realiza uma busca semantica no banco vetorial\n\n- Busca perfis de compradores que tenham aderencia com os oferecimentos da empresa.\n- Limite = 10\n","height":432,"width":320,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[512,-240],"id":"2c099071-8d56-4eb4-abac-3e0c272b50d0","name":"Sticky Note1"},{"parameters":{"content":"## Envia um e-mail aos n compradores mais aderentes.\n","height":320,"width":256,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1424,-128],"id":"ffb93722-deda-489c-9722-1c37f8ca831c","name":"Sticky Note2"},{"parameters":{"content":"## Busca o email daquele comprador\n","height":256,"width":560,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[848,-64],"id":"efb48b30-e9ec-421c-ac95-2c84469ccd6f","name":"Sticky Note3"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[224,256],"id":"7f9292d3-7a49-430d-a144-4264ad29963f","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[560,256],"id":"c1b4952f-1e62-4210-9fee-ba5305cfeec4","name":"Embeddings Google Gemini1","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"=data_empresa = {{ $json.empresa.toJsonString() }}","options":{"systemMessage":"=## Ferramentas Disponíveis\nVocê pode consultar o banco_cnaes para recuperar informações técnicas sobre CNAEs sempre que isso contribuir para entender melhor o perfil da empresa.\n\n---\n\n## Papel\nVocê é um agente especialista em interpretar dados empresariais mínimos — como CNAEs, natureza da operação e informações opcionais — e gerar um **resumo padronizado, conciso e vetorial** que represente o perfil real de atuação da empresa.\n\nSeu papel é sintetizar **o que essa empresa faz**, **como opera** e **qual o foco percebido**, mesmo quando os dados fornecidos são curtos ou limitados.\n\n---\n\n## Objetivo\nGerar um resumo em **3 parágrafos curtos**, seguindo rigorosamente o padrão:\n1. **Atuação principal da empresa** com base em CNAE e dados relevantes.  \n2. **Foco operacional, serviços e natureza das atividades**, usando CNAEs secundários quando fizer sentido.  \n3. **Contexto de mercado e abrangência geográfica percebida**, sem inventar nada fora do que está nos dados.\n\nO texto será usado em embeddings, portanto deve ser claro, coeso, técnico e direto.\n\n---\n\n## Instruções Gerais\n- Não invente informações — só use o que for derivável dos CNAEs e dados explícitos.  \n- Não cite códigos numéricos; traduza CNAEs em texto quando necessário.  \n- Se um CNAE tiver descrição útil, você pode recuperar a informação pelo banco vetorial.  \n- Não mencione ferramentas, consultas ou estrutura de JSON.  \n- Não inclua endereço, telefone, CNPJ ou qualquer dado administrativo.  \n- Não usar listas — apenas texto contínuo.  \n- Nenhum parágrafo deve ser muito longo; mantenha o estilo conciso dos few-shots fornecidos.\n\n---\n\n## Saída\nRetorne **somente o texto final**, composto por exatamente **3 parágrafos curtos**, seguindo o mesmo estilo dos exemplos.\n\nComece diretamente com o parágrafo 1, sem título “Resumo da Empresa” ou qualquer cabeçalho.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[224,16],"id":"9a0d7a95-196d-4261-8e61-6a246eeca8bd","name":"Criar resumo de empresa"},{"parameters":{"mode":"load","tableName":"busca_fornecedor_gemini","prompt":"={{ $json.output }}","topK":10,"includeDocumentMetadata":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[560,16],"id":"c6307f1c-42b9-43a0-a7c4-b135bb16d4f7","name":"busca_comprador","credentials":{"postgres":{"id":"MHRHdP7WLUhVnoIo","name":"pgvector"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"usuario_fornecedor","mode":"list","cachedResultName":"usuario_fornecedor"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.body.fornecedor_id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-464,16],"id":"02f03139-982d-4de1-b137-1a32d6186f81","name":"get_fornecedor","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"estabelecimento","mode":"list","cachedResultName":"estabelecimento"},"returnAll":true,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"},{"column":"cnpj_ordem","value":"={{ $json.cnpj_ordem }}"},{"column":"cnpj_dv","value":"={{ $json.cnpj_dv }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-304,16],"id":"b9de269e-932b-48e4-8783-6203204d2a9f","name":"get_estabelecimento","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"assignments":{"assignments":[{"id":"4d4879fc-cb7e-4ee8-8f52-43ff65d8dd7b","name":"empresa.matriz_filial","value":"={{ $('get_estabelecimento').item.json.matriz_filial }}","type":"string"},{"id":"e9045b84-7402-489d-b137-3eac706115aa","name":"empresa.cnae_fiscal","value":"={{ $('get_estabelecimento').item.json.cnae_fiscal }}","type":"string"},{"id":"36496f9e-8e75-4e0f-971f-471449b990fa","name":"empresa.cnae_fiscal_secundaria","value":"={{ $('get_estabelecimento').item.json.cnae_fiscal_secundaria }}","type":"string"},{"id":"ef876432-e914-46c8-8585-bdefcaa5492c","name":"empresa.uf","value":"={{ $('get_estabelecimento').item.json.uf }}","type":"string"},{"id":"f5e0ab30-d521-413e-bbbc-c9f57c0aec9d","name":"empresa.municipio","value":"={{ $('get_estabelecimento').item.json.municipio }}","type":"string"},{"id":"fd6337f7-ad28-41e3-8b2b-0a686a23972d","name":"empresa.resumo_empresa","value":"={{ $('get_estabelecimento').item.json.resumo_empresa }}","type":"string"},{"id":"afdb50d5-566d-4a84-8e76-bef856403c68","name":"empresa.especialidades","value":"={{ $('get_estabelecimento').item.json.especialidades }}","type":"string"},{"id":"10d36cc9-1c1b-4870-a482-669d3b5ce2ab","name":"empresa.categorias_materais","value":"={{ $('get_estabelecimento').item.json.categorias_materais }}","type":"string"},{"id":"c45568e9-0140-41e6-b6be-f808219cf09a","name":"empresa.razao_social","value":"={{ $json.razao_social }}","type":"string"},{"id":"5355b746-15a1-4031-aa19-52a3ac210125","name":"empresa.exemplo_servico","value":"={{ $('get_estabelecimento').item.json.exemplo_servico }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[48,16],"id":"239885e8-ce98-4fdf-8fc9-7c29d18210fd","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"0b908832-98ce-4f11-8b1f-1f80dacb8cee","name":"raw_user_meta_data.email","value":"={{ $json.raw_user_meta_data.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1280,16],"id":"b70d096d-c12a-452d-8d7d-0c5380c127ef","name":"set_emails"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"usuario_comprador","mode":"list","cachedResultName":"usuario_comprador"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.document.metadata.id_comprador }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[880,16],"id":"39867a17-da77-45cf-b203-ebcd5c01a26d","name":"get_comprador","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"auth","mode":"list","cachedResultName":"auth"},"table":{"__rl":true,"value":"users","mode":"list","cachedResultName":"users"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1088,16],"id":"8be6a6e7-a921-4774-aedd-8ec502f7b24d","name":"get_email","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1504,16],"id":"edba1b60-bc9e-4adb-a900-cdc13bdaaa39","name":"Loop Over Items"},{"parameters":{"sendTo":"=tbfelipe067@gmail.com","subject":"=Teste","message":"=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>Novo fornecedor Elite no seu segmento</title>\n\n  <style>\n    body {\n      margin: 0;\n      padding: 0;\n      background-color: #f9fafb;\n      font-family: \"Inter\", Arial, sans-serif;\n      color: #0f172a;\n    }\n\n    .container {\n      max-width: 600px;\n      margin: 40px auto;\n      background: #ffffff;\n      border-radius: 16px;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n      overflow: hidden;\n    }\n\n    .header {\n      background: linear-gradient(90deg, #0f172a, #00c38a);\n      color: #fff;\n      text-align: center;\n      padding: 24px;\n      font-size: 22px;\n      font-weight: 600;\n    }\n\n    .content {\n      padding: 32px 24px;\n      line-height: 1.6;\n    }\n\n    .content h1 {\n      font-size: 20px;\n      color: #0f172a;\n      margin-bottom: 16px;\n      text-align: left;\n    }\n\n    .content p {\n      font-size: 15px;\n      color: #475569;\n      margin-bottom: 20px;\n    }\n\n    .info-box {\n      background: #f1f5f9;\n      padding: 16px;\n      border-radius: 10px;\n      border: 1px solid #e2e8f0;\n      margin-bottom: 28px;\n      font-size: 14px;\n    }\n\n    .footer {\n      text-align: center;\n      font-size: 13px;\n      color: #94a3b8;\n      padding: 24px;\n      border-top: 1px solid #f1f5f9;\n      background-color: #f9fafb;\n    }\n\n    .unsubscribe-btn {\n      display: inline-block;\n      margin-top: 16px;\n      background: #ffe5e5;\n      color: #b91c1c !important;\n      text-decoration: none;\n      padding: 10px 22px;\n      border-radius: 8px;\n      font-weight: 600;\n      font-size: 14px;\n      border: 1px solid #fca5a5;\n      transition: 0.2s;\n    }\n\n    .unsubscribe-btn:hover {\n      background: #fecaca;\n    }\n\n    .unsubscribe-label {\n      margin-top: 6px;\n      font-size: 11px;\n      color: #94a3b8;\n      display: block;\n    }\n\n    @media (max-width: 600px) {\n      .content { padding: 24px 16px; }\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"container\">\n\n    <div class=\"header\">\n      BuscaFornecedor\n    </div>\n\n    <div class=\"content\">\n      <h1>Um fornecedor Elite pode te interessar!</h1>\n\n      <p>Um novo fornecedor do segmento que você acompanha acaba de ativar o <strong style=\"color:#00c38a;\">Plano Elite</strong> na plataforma.</p>\n\n      <p>Agora ele possui dados completos, mais credibilidade e maior prioridade nas recomendações.</p>\n\n      <div class=\"info-box\">\n        <strong>Razão Social:</strong> {{ $json.razao_social }}<br/>\n        <strong>Site:</strong> <a href=\"{{ $json.site }}\" target=\"_blank\">{{ $json.site }}</a><br/>\n        <strong>E-mail:</strong> {{ $json.email }}<br/><br/>\n        <strong>Resumo de Atuação:</strong><br/>\n        {{ $json.resumo_atuacao }}\n      </div>\n\n      <p>Continue acompanhando novos fornecedores e aproveite oportunidades de negócio qualificadas.</p>\n    </div>\n\n    <div class=\"footer\">\n      © 2025 BuscaFornecedor — Todos os direitos reservados.<br/>\n      <a href=\"https://buscafornecedor.com.br\" style=\"color:#00c38a; text-decoration:none;\">buscafornecedor.com.br</a><br/><br/>\n\n      <a\n        href=\"https://primary-kpc3-buscafornecedor.up.railway.app/webhook/unsubscribe?basico=[Execute previous nodes for preview]&ordem=[Execute previous nodes for preview]&dv=[Execute previous nodes for preview]\"\n        class=\"unsubscribe-btn\"\n      >\n        Não quero mais receber estes e-mails\n      </a>\n\n      <span class=\"unsubscribe-label\">Unsubscribe</span>\n    </div>\n  </div>\n</body>\n</html>\n","options":{"appendAttribution":false}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1904,96],"id":"170ddc2d-507b-4f95-8241-988d24a452d5","name":"email_recomendação","webhookId":"ddcfa1ef-90d1-4866-97e4-a61d894917da","credentials":{"gmailOAuth2":{"id":"JKcZrpzTg58STyhI","name":"cred: contato@contato-buscafornecedor.com.br"}}},{"parameters":{"assignments":{"assignments":[{"id":"9001f46e-7ffc-4a12-9ae7-f9557f1db677","name":"site","value":"={{ $('get_estabelecimento').item.json.site }}","type":"string"},{"id":"33fbff95-9173-4c10-9809-8fd73dc4b739","name":"email","value":"={{ $('get_estabelecimento').item.json.correio_eletronico }}","type":"string"},{"id":"a57257d5-9257-4268-a9da-cc66297d5334","name":"resumo_atuacao","value":"={{ $('Criar resumo de empresa').item.json.output }}","type":"string"},{"id":"aa9c90e9-0bd8-486c-bc3c-a294ea4a7ba8","name":"razao_social","value":"={{ $('get_estabelecimento1').item.json.razao_social }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1712,96],"id":"fba3d6a5-756a-414d-960c-381948603c63","name":"fornecedor_info"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"cnpj_db","mode":"list","cachedResultName":"cnpj_db"},"table":{"__rl":true,"value":"empresas","mode":"list","cachedResultName":"empresas"},"returnAll":true,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-128,16],"id":"c4839999-0a59-4489-9418-1931b81af3dd","name":"get_estabelecimento1","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}}],"connections":{"Webhook":{"main":[[{"node":"get_fornecedor","type":"main","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Criar resumo de empresa","type":"ai_languageModel","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"busca_comprador","type":"ai_embedding","index":0}]]},"Criar resumo de empresa":{"main":[[{"node":"busca_comprador","type":"main","index":0}]]},"get_fornecedor":{"main":[[{"node":"get_estabelecimento","type":"main","index":0}]]},"get_estabelecimento":{"main":[[{"node":"get_estabelecimento1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Criar resumo de empresa","type":"main","index":0}]]},"busca_comprador":{"main":[[{"node":"get_comprador","type":"main","index":0}]]},"get_comprador":{"main":[[{"node":"get_email","type":"main","index":0}]]},"get_email":{"main":[[{"node":"set_emails","type":"main","index":0}]]},"set_emails":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"fornecedor_info","type":"main","index":0}]]},"get_estabelecimento1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"fornecedor_info":{"main":[[{"node":"email_recomendação","type":"main","index":0}]]},"email_recomendação":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"authors":"ABC  advise","name":null,"description":null,"autosaved":false},"tags":[]}