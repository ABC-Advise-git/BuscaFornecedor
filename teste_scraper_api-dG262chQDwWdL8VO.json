{"updatedAt":"2025-12-01T19:48:46.508Z","createdAt":"2025-11-28T17:58:14.847Z","id":"dG262chQDwWdL8VO","name":"teste_scraper_api","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-256,-248],"id":"b8310af0-46be-4be8-aeba-f5fa7084a9f7","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"POST","url":"https://scraperapi-buscafornecedor.up.railway.app/analyze","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"api-scraper-busca"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"razao_social","value":"={{ $json.razao_social }}"},{"name":"cnpj","value":"={{ $json.cnpj_basico }}{{ $json.cnpj_ordem }}{{ $json.cnpj_dv }}"},{"name":"cnaes","value":"={{ $json.cnae_fiscal_secundaria.split()}}"},{"name":"nome_fantasia","value":"={{ $json.nome_fantasia }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1632,-224],"id":"d2f31b69-0d52-467b-93f3-432ddea78a17","name":"HTTP Request","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"=cnpj_db","mode":"name"},"table":{"__rl":true,"value":"estabelecimento","mode":"list","cachedResultName":"estabelecimento"},"limit":500,"where":{"values":[{"column":"site","condition":"IS NOT NULL"},{"column":"site","condition":"!=","value":"nao_encontrado"}]},"options":{"outputColumns":["cnpj_basico","cnpj_ordem","cnpj_dv","site","clientes","resumo_empresa","segmentos_industriais","tipo_fornecedor","especialidades","exemplo_servico","categorias_materais","telefone","instagram","email","nome_fantasia","cnae_fiscal","cnae_fiscal_secundaria"]}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-32,-248],"id":"974d98e9-f7f6-4e74-8180-f5fc9cc1b0d5","name":"Select rows from a table","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3527de29-618b-4d6d-9b98-358922bb4493","leftValue":"={{ $json.site }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"eea0e3eb-9c50-41f3-9ac3-3258300802f0","leftValue":"={{ $json.resumo_empresa }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[640,-248],"id":"a7d36e15-2e84-4fcd-abb5-afe92873bf4e","name":"Filter"},{"parameters":{"compare":"selectedFields","fieldsToCompare":"site","options":{}},"type":"n8n-nodes-base.removeDuplicates","typeVersion":2,"position":[864,-248],"id":"cad9a652-80e5-4e6c-bdfe-ad932fbbf41e","name":"Remove Duplicates"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"=cnpj_db","mode":"name"},"table":{"__rl":true,"value":"empresas","mode":"list","cachedResultName":"empresas"},"limit":1,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[192,-320],"id":"6330a098-0f3d-4284-b4f0-523ddec7b033","name":"Select rows from a table1","executeOnce":false,"credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"mode":"combine","fieldsToMatchString":"cnpj_basico","joinMode":"enrichInput1","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[416,-248],"id":"a4fdab4a-bae9-48bb-971e-ee9d61d14fa5","name":"Merge"},{"parameters":{"maxItems":10,"keep":"lastItems"},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[1088,-248],"id":"3a8c058d-fbb5-4265-a255-854e9588a86c","name":"Limit"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1312,-248],"id":"c7d4a8d3-3a24-4cde-ba6a-8f544d3e652a","name":"Loop Over Items"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Select rows from a table","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Select rows from a table":{"main":[[{"node":"Select rows from a table1","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Filter":{"main":[[{"node":"Remove Duplicates","type":"main","index":0}]]},"Remove Duplicates":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Select rows from a table1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Filter","type":"main","index":0}]]},"Limit":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"74f7ed68-f329-4dcd-93cb-6aa11db0fa95","triggerCount":0,"shared":[{"updatedAt":"2025-11-28T17:58:14.847Z","createdAt":"2025-11-28T17:58:14.847Z","role":"workflow:owner","workflowId":"dG262chQDwWdL8VO","projectId":"jk0yZKautC5L7CBp"}],"tags":[]}