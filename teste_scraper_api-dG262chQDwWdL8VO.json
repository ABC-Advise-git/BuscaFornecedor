{"updatedAt":"2025-12-03T08:02:32.392Z","createdAt":"2025-11-28T17:58:14.847Z","id":"dG262chQDwWdL8VO","name":"teste_scraper_api","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-256,-256],"id":"b8310af0-46be-4be8-aeba-f5fa7084a9f7","name":"When clicking ‘Execute workflow’"},{"parameters":{"method":"POST","url":"https://scraperapi-buscafornecedor.up.railway.app/analyze","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"api-scraper-busca"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"razao_social","value":"={{ $json.razao_social }}"},{"name":"cnpj","value":"={{ $json.cnpj_basico }}{{ $json.cnpj_ordem }}{{ $json.cnpj_dv }}"},{"name":"cnaes","value":"={{ $json.cnae_fiscal_secundaria.split()}}"},{"name":"nome_fantasia","value":"={{ $json.nome_fantasia }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1840,-224],"id":"d2f31b69-0d52-467b-93f3-432ddea78a17","name":"HTTP Request","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"=cnpj_db","mode":"name"},"table":{"__rl":true,"value":"estabelecimento","mode":"list","cachedResultName":"estabelecimento"},"limit":500,"where":{"values":[{"column":"site","condition":"IS NOT NULL"},{"column":"site","condition":"!=","value":"nao_encontrado"}]},"options":{"outputColumns":["cnpj_basico","cnpj_ordem","cnpj_dv","site","clientes","resumo_empresa","segmentos_industriais","tipo_fornecedor","especialidades","exemplo_servico","categorias_materais","telefone","instagram","email","nome_fantasia","cnae_fiscal","cnae_fiscal_secundaria"]}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-32,-256],"id":"974d98e9-f7f6-4e74-8180-f5fc9cc1b0d5","name":"Select rows from a table","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3527de29-618b-4d6d-9b98-358922bb4493","leftValue":"={{ $json.site }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}},{"id":"eea0e3eb-9c50-41f3-9ac3-3258300802f0","leftValue":"={{ $json.resumo_empresa }}","rightValue":"nao_encontrado","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[640,-256],"id":"a7d36e15-2e84-4fcd-abb5-afe92873bf4e","name":"Filter"},{"parameters":{"compare":"selectedFields","fieldsToCompare":"site","options":{}},"type":"n8n-nodes-base.removeDuplicates","typeVersion":2,"position":[864,-256],"id":"cad9a652-80e5-4e6c-bdfe-ad932fbbf41e","name":"Remove Duplicates"},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"=cnpj_db","mode":"name"},"table":{"__rl":true,"value":"empresas","mode":"list","cachedResultName":"empresas"},"limit":1,"where":{"values":[{"column":"cnpj_basico","value":"={{ $json.cnpj_basico }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[208,-384],"id":"6330a098-0f3d-4284-b4f0-523ddec7b033","name":"Select rows from a table1","executeOnce":false,"credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"mode":"combine","fieldsToMatchString":"cnpj_basico","joinMode":"enrichInput1","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[416,-256],"id":"a4fdab4a-bae9-48bb-971e-ee9d61d14fa5","name":"Merge"},{"parameters":{"maxItems":50,"keep":"lastItems"},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[1088,-256],"id":"3a8c058d-fbb5-4265-a255-854e9588a86c","name":"Limit"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1520,-256],"id":"c7d4a8d3-3a24-4cde-ba6a-8f544d3e652a","name":"Loop Over Items"},{"parameters":{"maxItems":15},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[1280,-304],"id":"3f8c09cd-cc59-4b2b-887a-1661317f9bc7","name":"Limit1"},{"parameters":{"assignments":{"assignments":[{"id":"56a9f528-e434-4479-bd36-6703acb82401","name":"razao_social","value":"={{ $json.razao_social }}","type":"string"},{"id":"8d633b7b-246c-4714-8cfe-038bb91cb3bc","name":"site","value":"={{ $json.site }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1616,-752],"id":"656c7c67-eb13-4610-b298-90ce86d97a8e","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"4ccee670-6a6f-4f68-b53f-bf6cc1d767d8","name":"razao_social","value":"={{ $json.razao_social }}","type":"string"},{"id":"17cf10c8-bc3e-4396-ba86-c911bc69fc5e","name":"site","value":"={{ $json.site }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1488,-496],"id":"1bc5b2a1-f643-4881-8284-40859b9486b9","name":"Edit Fields1"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Select rows from a table","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Select rows from a table":{"main":[[{"node":"Select rows from a table1","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"Filter":{"main":[[{"node":"Remove Duplicates","type":"main","index":0}]]},"Remove Duplicates":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Select rows from a table1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Filter","type":"main","index":0}]]},"Limit":{"main":[[{"node":"Limit1","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"HTTP Request","type":"main","index":0}]]},"Limit1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When clicking ‘Execute workflow’":[{"json":{}}]},"versionId":"082365c2-8d87-433e-9a8b-3a28dfef51bb","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-28T17:58:14.847Z","createdAt":"2025-11-28T17:58:14.847Z","role":"workflow:owner","workflowId":"dG262chQDwWdL8VO","projectId":"jk0yZKautC5L7CBp"}],"activeVersion":null,"tags":[]}