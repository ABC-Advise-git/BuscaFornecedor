{"updatedAt":"2025-11-28T20:02:22.731Z","createdAt":"2025-11-26T15:26:30.058Z","id":"YEViBt2zknRboJta","name":"update_compradores_vector","active":false,"isArchived":false,"nodes":[{"parameters":{"mode":"load","tableName":"busca_fornecedor_gemini","options":{"metadata":{"metadataValues":[{"name":"id_comprador"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[-1904,-1136],"id":"b1c44c40-c716-4b76-83cf-ccb39ecc7de1","name":"Postgres PGVector Store","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"busca_fornecedor_gemini","mode":"list","cachedResultName":"busca_fornecedor_gemini"},"deleteCommand":"delete","where":{"values":[{"column":"metadata"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1520,-976],"id":"b3b6fb73-a6bc-4809-80a6-8bfadc6bc621","name":"Delete table or rows","credentials":{"postgres":{"id":"MHRHdP7WLUhVnoIo","name":"pgvector"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[-1936,-992],"id":"031a0f18-2a04-4a63-855d-8ed968b38765","name":"Embeddings Google Gemini","credentials":{"googlePalmApi":{"id":"NFDJdyFl82zPlGi4","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"consultas","mode":"list","cachedResultName":"consultas"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.id_consulta }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2096,-1328],"id":"87a05499-7228-47c3-ae47-24eb1de63478","name":"get_consulta","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"assignments":{"assignments":[{"id":"3b77383b-1cd3-4460-acae-cef18dcdec05","name":"consulta.id","value":"={{ $json.id }}","type":"string"},{"id":"6d333dec-99ee-4480-8804-ee67c75e88aa","name":"consulta.cidade_origem","value":"={{ $json.parametros.cidade_origem }}","type":"string"},{"id":"610459b8-232f-4b2a-bacf-642f5cf3744b","name":"consulta.cnpjs_existentes","value":"={{ $json.parametros.cnpjs_existentes }}","type":"string"},{"id":"55b059a5-9baa-42ce-9547-324babf8a41d","name":"consulta.segmento","value":"={{ $json.parametros.segmento }}","type":"string"},{"id":"1a4323e2-647d-47b3-b333-7dc82c0a21cf","name":"consulta.descricao","value":"={{ $json.parametros.descricao }}","type":"string"},{"id":"390732fc-71c1-4e8d-bbdf-78c7cfe1ce22","name":"consulta.ufs_selecionadas","value":"={{ ($json.parametros.ufs_selecionadas?.length > 0)\n    ? $json.parametros.ufs_selecionadas.toJsonString()\n    : \"\"\n}}\n","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1408,-1328],"id":"ebc2a2ec-dbbd-4ed1-839f-91f0e18f1fc0","name":"set_consultas","alwaysOutputData":true},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"usuario_comprador","mode":"list","cachedResultName":"usuario_comprador"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.comprador }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1856,-1328],"id":"47d61aab-b244-4b02-a84d-eeb3b23bbdf8","name":"get_comprador","credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"value":"busca_fornecedor","mode":"list","cachedResultName":"busca_fornecedor"},"table":{"__rl":true,"value":"consultas","mode":"list","cachedResultName":"consultas"},"returnAll":true,"where":{"values":[{"column":"comprador","value":"={{ $json.id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1632,-1328],"id":"b9ebebee-cdeb-4b14-b1ba-a9dd892f4855","name":"get_histórico","alwaysOutputData":true,"credentials":{"postgres":{"id":"8MXZ6U3UVpvutTEe","name":"Supabase"}}},{"parameters":{"operation":"get","key":"={{ $('filtros_supabase').item.json.consulta_id }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-1168,-1168],"id":"6e877230-12c2-463a-bdc5-fe50b176aacd","name":"get1","executeOnce":true,"credentials":{"redis":{"id":"e8TEVWEpT7yUTHVI","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1db1d21c-8eb2-4852-896e-5d0f7bde70ec","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-1168,-864],"id":"9cbf45b9-718c-408c-88e9-ee7cf3899b11","name":"Filter"},{"parameters":{"workflowInputs":{"values":[{"name":"_cnaes","type":"array"},{"name":"_uf_filtro","type":"array"},{"name":"_data_limite"},{"name":"_termos","type":"array"},{"name":"_porte_empresa","type":"array"},{"name":"_natureza_juridica","type":"array"},{"name":"_codigo_municipio","type":"array"},{"name":"escopo_segmento"},{"name":"tipo_busca"},{"name":"id_consulta"},{"name":"n_cnaes_buscados"},{"name":"range_busca","type":"number"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-2384,-480],"id":"5aa429bc-25a1-4af9-aac2-52b6ed26cb12","name":"filtros_supabase"},{"parameters":{"operation":"get","key":"={{ $json.id_consulta }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-1168,-1328],"id":"ff6527f9-e068-4154-9027-86a956f7dfdf","name":"get","credentials":{"redis":{"id":"e8TEVWEpT7yUTHVI","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"28e68fc3-55d7-49d1-84b8-dc846857fcc8","leftValue":"={{ $json.razao_social }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-1168,-1008],"id":"f8946341-173d-4232-b30a-c23fe146a13a","name":"Filter1"},{"parameters":{"mode":"raw","jsonOutput":"\n  {\n    \"_cnaes\": [\n      \"3319800\",\n      \"1623400\"\n    ],\n    \"_uf_filtro\": [\n      \"SP\",\n      \"MG\"\n    ],\n    \"_data_limite\": \"20240101\\n\",\n    \"_termos\": [\n      \"palet\",\n      \"madeir\",\n      \"reform\",\n      \"recic\",\n      \"recup\",\n      \"recond\",\n      \"usado\",\n      \"indust\",\n      \"carg\",\n      \"embal\",\n      \"madeira\",\n      \"palete\",\n      \"reforma\",\n      \"repar\",\n      \"reutil\",\n      \"eco\",\n      \"sustent\",\n      \"logist\",\n      \"transp\",\n      \"estoq\"\n    ],\n    \"_porte_empresa\": [\n      \"00\",\n      \"01\",\n      \"05\",\n      \"03\"\n    ],\n    \"_natureza_juridica\": [\n      \"2062\"\n    ],\n    \"_codigo_municipio\": [\n      \"0444\",\n      \"6137\",\n      \"6725\",\n      \"7133\",\n      \"6843\",\n      \"2955\",\n      \"7061\",\n      \"6867\",\n      \"8253\",\n      \"6741\",\n      \"6595\",\n      \"6641\",\n      \"7143\",\n      \"6109\",\n      \"6553\",\n      \"2953\",\n      \"6837\",\n      \"6569\",\n      \"4867\",\n      \"6717\",\n      \"6251\",\n      \"6291\",\n      \"7225\",\n      \"5381\",\n      \"7927\",\n      \"6831\",\n      \"2957\",\n      \"5563\",\n      \"4875\",\n      \"7237\",\n      \"6175\",\n      \"6357\",\n      \"6605\",\n      \"6647\",\n      \"4697\",\n      \"8719\",\n      \"4501\",\n      \"2951\",\n      \"2959\",\n      \"6181\",\n      \"4181\",\n      \"2949\",\n      \"7149\",\n      \"6769\",\n      \"6619\",\n      \"6865\",\n      \"4671\",\n      \"6549\",\n      \"6611\",\n      \"6293\",\n      \"6241\",\n      \"6873\",\n      \"7233\",\n      \"4027\",\n      \"6131\",\n      \"6581\",\n      \"6345\",\n      \"4919\",\n      \"4611\",\n      \"2689\",\n      \"6511\",\n      \"6737\",\n      \"4209\",\n      \"6427\",\n      \"6749\",\n      \"7063\",\n      \"7017\",\n      \"6639\",\n      \"4157\",\n      \"6429\",\n      \"6671\",\n      \"4051\",\n      \"4211\",\n      \"6399\",\n      \"6281\",\n      \"6165\",\n      \"6105\",\n      \"6285\",\n      \"6349\",\n      \"4397\",\n      \"4165\",\n      \"0740\",\n      \"7005\",\n      \"6269\",\n      \"6529\",\n      \"4597\",\n      \"7083\",\n      \"4489\",\n      \"6883\",\n      \"6309\",\n      \"7035\",\n      \"6579\",\n      \"6505\",\n      \"5315\",\n      \"7047\",\n      \"6107\",\n      \"6943\",\n      \"6635\",\n      \"6719\",\n      \"5183\",\n      \"3067\",\n      \"6981\",\n      \"5887\",\n      \"6979\",\n      \"4369\",\n      \"7037\",\n      \"9689\",\n      \"6477\",\n      \"4629\",\n      \"6177\",\n      \"6875\",\n      \"6213\",\n      \"6789\",\n      \"6313\",\n      \"4547\",\n      \"6601\",\n      \"4205\",\n      \"0936\",\n      \"5445\",\n      \"4357\",\n      \"7025\",\n      \"6551\",\n      \"6563\",\n      \"6913\",\n      \"7231\",\n      \"6735\",\n      \"7107\",\n      \"5049\",\n      \"7113\",\n      \"6897\",\n      \"6361\",\n      \"6415\",\n      \"4945\",\n      \"6523\",\n      \"7157\",\n      \"6355\",\n      \"5035\",\n      \"6669\",\n      \"7077\",\n      \"6887\",\n      \"7151\",\n      \"4355\",\n      \"7099\",\n      \"7273\",\n      \"5307\",\n      \"7073\",\n      \"3065\",\n      \"6589\",\n      \"6401\",\n      \"6335\",\n      \"7191\",\n      \"6317\",\n      \"4193\",\n      \"6713\",\n      \"6467\",\n      \"7027\",\n      \"0516\",\n      \"7057\",\n      \"6577\",\n      \"7117\",\n      \"4487\",\n      \"6377\",\n      \"6139\",\n      \"7065\",\n      \"6689\",\n      \"6331\",\n      \"6239\",\n      \"6545\",\n      \"7145\",\n      \"0802\",\n      \"7075\",\n      \"4105\",\n      \"6111\",\n      \"6379\",\n      \"6495\",\n      \"6629\",\n      \"7243\",\n      \"6271\",\n      \"6967\",\n      \"7021\",\n      \"6915\",\n      \"1851\",\n      \"7109\",\n      \"6521\",\n      \"6573\",\n      \"5191\",\n      \"5287\",\n      \"6295\",\n      \"5245\",\n      \"5347\",\n      \"6231\",\n      \"0560\",\n      \"4219\",\n      \"6983\",\n      \"7167\",\n      \"4167\",\n      \"6157\",\n      \"7095\",\n      \"6375\",\n      \"6599\",\n      \"6403\",\n      \"7197\",\n      \"7183\",\n      \"5447\",\n      \"6851\",\n      \"5019\",\n      \"6275\",\n      \"5033\",\n      \"6857\",\n      \"6307\",\n      \"7001\",\n      \"5017\",\n      \"6347\",\n      \"7181\",\n      \"7051\",\n      \"4271\",\n      \"5263\",\n      \"7007\",\n      \"6333\",\n      \"5395\",\n      \"6861\",\n      \"6813\",\n      \"6371\",\n      \"7173\",\n      \"4647\",\n      \"7079\",\n      \"8315\",\n      \"6711\",\n      \"4293\",\n      \"6145\",\n      \"6947\",\n      \"6625\",\n      \"4189\",\n      \"4981\",\n      \"4779\",\n      \"4887\",\n      \"2965\",\n      \"4447\",\n      \"7041\",\n      \"4583\",\n      \"7071\",\n      \"5421\",\n      \"7943\",\n      \"1857\",\n      \"7121\",\n      \"6259\",\n      \"4343\",\n      \"7195\",\n      \"0816\",\n      \"5337\",\n      \"7053\",\n      \"4379\",\n      \"6911\",\n      \"6921\",\n      \"8271\",\n      \"2995\",\n      \"4881\",\n      \"4797\",\n      \"4081\",\n      \"5239\",\n      \"6987\",\n      \"7123\"\n    ],\n    \"escopo_segmento\": \"reforma de palete de madeira, Contratação de reformadora de paletes de madeira\",\n    \"tipo_busca\": \"especifica\",\n    \"consulta_id\": \"0665bbf9-7a3c-4982-abdf-f1336abbab66\",\n    \"n_cnaes_buscados\": \"1\",\n    \"range_busca\": 400\n  }\n\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1520,-1136],"id":"64c58e94-2876-4d48-bd8d-654712a9f043","name":"Edit Fields"},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.get_estabelecimentos_filtrados_avancado_com_site($1, $2, $3, $4, $5, $6, $7, $8, $9);\n","options":{"connectionTimeout":500,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._termos === 'string') ? JSON.parse($json._termos) : $json._termos,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2432,-1120],"id":"e1ad4261-cd4d-4a36-a6a3-28b2f4fcdb88","name":"filtrado_com_site","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"mode":"raw","jsonOutput":"\n  {\n    \"_cnaes\": [\n      \"3319800\",\n      \"1623400\"\n    ],\n    \"_uf_filtro\": [\n      \"SP\",\n      \"MG\"\n    ],\n    \"_data_limite\": \"20240101\",\n    \"_termos\": [\n      \"palet\",\n      \"madeir\",\n      \"reform\",\n      \"recic\",\n      \"recup\",\n      \"recond\",\n      \"usado\",\n      \"indust\",\n      \"carg\",\n      \"embal\",\n      \"madeira\",\n      \"palete\",\n      \"reforma\",\n      \"repar\",\n      \"reutil\",\n      \"eco\",\n      \"sustent\",\n      \"logist\",\n      \"transp\",\n      \"estoq\"\n    ],\n    \"_porte_empresa\": [\n      \"00\",\n      \"01\",\n      \"05\",\n      \"03\"\n    ],\n    \"_natureza_juridica\": [\n      \"2062\"\n    ],\n    \"_codigo_municipio\": [\n      \"0444\",\n      \"6137\",\n      \"6725\",\n      \"7133\",\n      \"6843\",\n      \"2955\",\n      \"7061\",\n      \"6867\",\n      \"8253\",\n      \"6741\",\n      \"6595\",\n      \"6641\",\n      \"7143\",\n      \"6109\",\n      \"6553\",\n      \"2953\",\n      \"6837\",\n      \"6569\",\n      \"4867\",\n      \"6717\",\n      \"6251\",\n      \"6291\",\n      \"7225\",\n      \"5381\",\n      \"7927\",\n      \"6831\",\n      \"2957\",\n      \"5563\",\n      \"4875\",\n      \"7237\",\n      \"6175\",\n      \"6357\",\n      \"6605\",\n      \"6647\",\n      \"4697\",\n      \"8719\",\n      \"4501\",\n      \"2951\",\n      \"2959\",\n      \"6181\",\n      \"4181\",\n      \"2949\",\n      \"7149\",\n      \"6769\",\n      \"6619\",\n      \"6865\",\n      \"4671\",\n      \"6549\",\n      \"6611\",\n      \"6293\",\n      \"6241\",\n      \"6873\",\n      \"7233\",\n      \"4027\",\n      \"6131\",\n      \"6581\",\n      \"6345\",\n      \"4919\",\n      \"4611\",\n      \"2689\",\n      \"6511\",\n      \"6737\",\n      \"4209\",\n      \"6427\",\n      \"6749\",\n      \"7063\",\n      \"7017\",\n      \"6639\",\n      \"4157\",\n      \"6429\",\n      \"6671\",\n      \"4051\",\n      \"4211\",\n      \"6399\",\n      \"6281\",\n      \"6165\",\n      \"6105\",\n      \"6285\",\n      \"6349\",\n      \"4397\",\n      \"4165\",\n      \"0740\",\n      \"7005\",\n      \"6269\",\n      \"6529\",\n      \"4597\",\n      \"7083\",\n      \"4489\",\n      \"6883\",\n      \"6309\",\n      \"7035\",\n      \"6579\",\n      \"6505\",\n      \"5315\",\n      \"7047\",\n      \"6107\",\n      \"6943\",\n      \"6635\",\n      \"6719\",\n      \"5183\",\n      \"3067\",\n      \"6981\",\n      \"5887\",\n      \"6979\",\n      \"4369\",\n      \"7037\",\n      \"9689\",\n      \"6477\",\n      \"4629\",\n      \"6177\",\n      \"6875\",\n      \"6213\",\n      \"6789\",\n      \"6313\",\n      \"4547\",\n      \"6601\",\n      \"4205\",\n      \"0936\",\n      \"5445\",\n      \"4357\",\n      \"7025\",\n      \"6551\",\n      \"6563\",\n      \"6913\",\n      \"7231\",\n      \"6735\",\n      \"7107\",\n      \"5049\",\n      \"7113\",\n      \"6897\",\n      \"6361\",\n      \"6415\",\n      \"4945\",\n      \"6523\",\n      \"7157\",\n      \"6355\",\n      \"5035\",\n      \"6669\",\n      \"7077\",\n      \"6887\",\n      \"7151\",\n      \"4355\",\n      \"7099\",\n      \"7273\",\n      \"5307\",\n      \"7073\",\n      \"3065\",\n      \"6589\",\n      \"6401\",\n      \"6335\",\n      \"7191\",\n      \"6317\",\n      \"4193\",\n      \"6713\",\n      \"6467\",\n      \"7027\",\n      \"0516\",\n      \"7057\",\n      \"6577\",\n      \"7117\",\n      \"4487\",\n      \"6377\",\n      \"6139\",\n      \"7065\",\n      \"6689\",\n      \"6331\",\n      \"6239\",\n      \"6545\",\n      \"7145\",\n      \"0802\",\n      \"7075\",\n      \"4105\",\n      \"6111\",\n      \"6379\",\n      \"6495\",\n      \"6629\",\n      \"7243\",\n      \"6271\",\n      \"6967\",\n      \"7021\",\n      \"6915\",\n      \"1851\",\n      \"7109\",\n      \"6521\",\n      \"6573\",\n      \"5191\",\n      \"5287\",\n      \"6295\",\n      \"5245\",\n      \"5347\",\n      \"6231\",\n      \"0560\",\n      \"4219\",\n      \"6983\",\n      \"7167\",\n      \"4167\",\n      \"6157\",\n      \"7095\",\n      \"6375\",\n      \"6599\",\n      \"6403\",\n      \"7197\",\n      \"7183\",\n      \"5447\",\n      \"6851\",\n      \"5019\",\n      \"6275\",\n      \"5033\",\n      \"6857\",\n      \"6307\",\n      \"7001\",\n      \"5017\",\n      \"6347\",\n      \"7181\",\n      \"7051\",\n      \"4271\",\n      \"5263\",\n      \"7007\",\n      \"6333\",\n      \"5395\",\n      \"6861\",\n      \"6813\",\n      \"6371\",\n      \"7173\",\n      \"4647\",\n      \"7079\",\n      \"8315\",\n      \"6711\",\n      \"4293\",\n      \"6145\",\n      \"6947\",\n      \"6625\",\n      \"4189\",\n      \"4981\",\n      \"4779\",\n      \"4887\",\n      \"2965\",\n      \"4447\",\n      \"7041\",\n      \"4583\",\n      \"7071\",\n      \"5421\",\n      \"7943\",\n      \"1857\",\n      \"7121\",\n      \"6259\",\n      \"4343\",\n      \"7195\",\n      \"0816\",\n      \"5337\",\n      \"7053\",\n      \"4379\",\n      \"6911\",\n      \"6921\",\n      \"8271\",\n      \"2995\",\n      \"4881\",\n      \"4797\",\n      \"4081\",\n      \"5239\",\n      \"6987\",\n      \"7123\"\n    ],\n    \"escopo_segmento\": \"reforma de palete de madeira, Contratação de reformadora de paletes de madeira\",\n    \"tipo_busca\": \"especifica\",\n    \"consulta_id\": \"0665bbf9-7a3c-4982-abdf-f1336abbab66\",\n    \"n_cnaes_buscados\": 2,\n    \"range_busca\": 1000\n  }\n\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2112,-496],"id":"d84a01ed-493e-4062-8506-1caa147be041","name":"Edit Fields4"},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.get_estabelecimentos_otimizada_com_mv($1, $2, $3, $4, $5, $6, $7, $8, $9);\n","options":{"connectionTimeout":1000,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._termos === 'string') ? JSON.parse($json._termos) : $json._termos,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1552,16],"id":"8c4dfac1-10d8-4897-9340-dd9f8299a19c","name":"busca_view_materializada","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.get_estabelecimentos_otimizada_com_mv_sem_termos($1, $2, $3, $4, $5, $6, $7, $8);\n","options":{"connectionTimeout":1000,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1552,-160],"id":"d9b94a9a-d962-48fd-a423-6ec78665a0ca","name":"busca_view_sem_termos1","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.get_estabelecimentos_filtrados_avancado_com_site_sem_termos($1, $2, $3, $4, $5, $6, $7, $8);\n","options":{"connectionTimeout":1000,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2432,-928],"id":"18fbc06b-68a1-41b3-b235-be1800598821","name":"busca_sem_termos","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.busca_empresas_cnae_flexivel($1, $2, $3, $4, $5, $6, $7, $8, $9);\n","options":{"connectionTimeout":500,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._termos === 'string') ? JSON.parse($json._termos) : $json._termos,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2640,-1120],"id":"5f8992f8-0d31-46bd-b6d1-5c8712af08ac","name":"V2-busca_filtrada_com_site","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.v2_get_estabelecimentos_filtrados_avancado_com_site_sem_termos($1, $2, $3, $4, $5, $6, $7, $8);\n","options":{"connectionTimeout":1000,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2640,-928],"id":"8574a03d-e0fa-4434-ae87-92b0100d0607","name":"V2_get_estabelecimentos_com_site_sem_termos","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"SELECT * FROM cnpj_db.V2_get_estabelecimentos_otimizada_com_mv_sem_termos($1, $2, $3, $4, $5, $6, $7, $8);\n","options":{"connectionTimeout":1000,"queryReplacement":"={{\n[\n  (typeof ($json.concatenated_todos_codigos_cnae || $('filtros_supabase').first().json._cnaes) === 'string') ? JSON.parse($json.concatenated_todos_codigos_cnae || $json.first().json._cnaes) : ($json.concatenated_todos_codigos_cnae || $json._cnaes),\n\n  (typeof $json._uf_filtro === 'string') ? JSON.parse($json._uf_filtro) : $json._uf_filtro,\n\n  $json._data_limite,\n\n  (typeof $json._porte_empresa === 'string') ? JSON.parse($json._porte_empresa) : $json._porte_empresa,\n\n  (typeof $json._natureza_juridica === 'string') ? JSON.parse($json._natureza_juridica) : $json._natureza_juridica,\n\n  (typeof $json._codigo_municipio === 'string') ? JSON.parse($json._codigo_municipio) : $json._codigo_municipio\n,\n\n$json.range_busca,\n\n$json.n_cnaes_buscados]\n}}"}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1264,-160],"id":"c83bf691-f07c-4a5c-bedb-2693356b6950","name":"busca_view_sem_termos","alwaysOutputData":true,"credentials":{"postgres":{"id":"RYnJHwRNP94saMdt","name":"Postgres account"}}}],"connections":{"Embeddings Google Gemini":{"ai_embedding":[[{"node":"Postgres PGVector Store","type":"ai_embedding","index":0}]]},"get_consulta":{"main":[[{"node":"get_comprador","type":"main","index":0}]]},"get_comprador":{"main":[[{"node":"get_histórico","type":"main","index":0}]]},"get_histórico":{"main":[[{"node":"set_consultas","type":"main","index":0}]]},"get1":{"main":[[]]},"filtros_supabase":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"get":{"main":[[]]},"Edit Fields":{"main":[[]]},"Edit Fields4":{"main":[[]]},"busca_view_materializada":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"get1":[{"json":{"propertyName":["SPEERS FOODS IMPORTACAO, EXPORTACAO E COMERCIO DE ALIMENTOS LTDA","MULTIFOODS COMERCIO DE ALIMENTOS E BEBIDAS LTDA","REFEICOES BRAS FOOD LTDA","BARRA MANSA COMERCIO DE CARNES E DERIVADOS LIMITADA","DRACAR COMERCIO DE ALIMENTOS LTDA","ANTARES BRASIL INDUSTRIA E COMERCIO DE ALIMENTOS LTDA-EM RECUPERACAO JUDICIAL","AVANTE COMERCIO DE PRODUTOS ALIMENTICIOS LTDA","KI-DELICIA COMERCIO E DISTRIBUICAO LTDA","A & B ALIMENTOS E BEBIDAS LTDA","P.R.NETTO - INDUSTRIA E COMERCIO DE ALIMENTOS LTDA","AMANHECER ATACADO DE PRODUTOS ALIMENTICIOS LTDA","PAMA COMERCIO DE GENEROS ALIMENTICIOS LTDA.","EJTX COMERCIO DE PRODUTOS ALIMENTICIOS E MAQUINAS E EQUIPAMENTOS INDUSTRIAIS LTDA.","MASTER RIO COMERCIO E SERVICOS LTDA","DISTRIBUIDORA DE ALIMENTOS MARFIM LTDA","MARCOMAR COMERCIO DE ALIMENTOS LTDA","JIREH DISTRIBUIDOR FOODS SERVICE LTDA","LA CASA DEL SAPORE ALIMENTOS E COMERCIO LTDA","DML DISTRIBUIDORA DE ALIMENTOS E EMBALAGENS LTDA","DISTRIBUIDORA DE ALIMENTOS J ANDRADE LTDA","DEMARCHI COMERCIO DE ALIMENTOS LTDA","JJ COMERCIAL E DISTRIBUIDORA DE GENEROS ALIMENTICIOS LT","DNA COMERCIO E REPRESENTACOES LTDA"]}}],"filtros_supabase":[{"json":{"_cnaes":["4691500","4693100","8299702","4617600","4635499","4634601","4631100","5620101","4639701","4637199"],"_uf_filtro":["RN"],"_data_limite":"20200101\n","_termos":["foodserv","distrib","alimentos","gastr","rest","supermerc","cozinha","ingred","produt","aliment","catering","hotelaria","refeico","fornec","servico","equip","utensil","embal","frios","padaria"],"_porte_empresa":["02","00","01","05","03"],"_natureza_juridica":["2062"],"escopo_segmento":"food service, distribuidora foodservice ","tipo_busca":"generalista","id_consulta":"8b5ee496-3b67-4fdc-a2c0-030696899416","n_cnaes_buscados":"2","range_busca":1500}}]},"versionId":"59de122d-1592-48e8-8e17-35f2c7405f03","triggerCount":0,"shared":[{"updatedAt":"2025-11-26T15:26:30.058Z","createdAt":"2025-11-26T15:26:30.058Z","role":"workflow:owner","workflowId":"YEViBt2zknRboJta","projectId":"jk0yZKautC5L7CBp"}],"tags":[]}